<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.4 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Automatic Multi-Site Configuration - Spartacus Documentation</title>
<meta name="description" content="SAP Spartacus JavaScript Storefront Documentation.">



<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Spartacus Documentation">
<meta property="og:title" content="Automatic Multi-Site Configuration">
<meta property="og:url" content="/spartacus-docs/1.x/automatic-context-configuration/">












  

  


<link rel="canonical" href="/spartacus-docs/1.x/automatic-context-configuration/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": null,
      "url": null,
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/spartacus-docs/1.x/feed.xml" type="application/atom+xml" rel="alternate" title="Spartacus Documentation Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/spartacus-docs/1.x/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert scripts for adding anchor links to headers -->

<script src="https://kit.fontawesome.com/82d5a2bf2f.js" crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js"></script>
<script>
  anchors.add();
</script>

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" /> 
  </head>

  <body class="layout--home">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/spartacus-docs/1.x/"><img src="/spartacus-docs/1.x/assets/images/logo-blue_64x64.png" alt=""></a>
        
        <a class="site-title" href="/spartacus-docs/1.x/">Spartacus Documentation</a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/spartacus-docs/1.x/docs-archive/" >Doc Archive</a>
            </li><li class="masthead__menu-item">
              <a href="https://join.slack.com/t/spartacus-storefront/shared_invite/enQtNDM1OTI3OTMwNjU5LTg1NGVjZmFkZjQzODc1MzFhMjc3OTZmMzIzYzg0YjMwODJiY2YxYjA5MTE5NjVmN2E5NjMxNjEzMGNlMDRjMjU" >Feedback</a>
            </li><li class="masthead__menu-item">
              <a href="https://stackoverflow.com/questions/tagged/spartacus-storefront" >Support</a>
            </li><li class="masthead__menu-item">
              <a href="/spartacus-docs/1.x/release-information/" >Version 1.5</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle menu</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">Home</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/spartacus-docs/1.x/" class="">About Spartacus</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/release-information/" class="">Release Information ➢</a>
 
              

              
                <ul>
                  
                    

                     
                   
                 </ul>
                 
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/spartacus-videos/" class="">Spartacus Videos</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/spartacus-roadmap/" class="">Spartacus Roadmap</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/spartacus-faq/" class="">Spartacus FAQ</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/docs-archive/" class="">Documentation Archive</a>
 
              

                
             </li>
           
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Getting Started with Spartacus Libraries</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/spartacus-docs/1.x/installing-sap-commerce-cloud/" class="">Installing SAP Commerce Cloud for use with Spartacus ➢</a>
 
              

              
                <ul>
                  
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                 </ul>
                 
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/cors/" class="">Cross-Origin Resource Sharing (CORS)</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/building-the-spartacus-storefront-from-libraries/" class="">Building the Spartacus Storefront from Libraries</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/recommended-development-environment/" class="">Recommended Development Environment</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/snapshot-builds/" class="">Snapshot Builds</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/configuring-feature-flags/" class="">Configuring Feature Flags</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/smartEdit-setup-instructions-for-spartacus/" class="">SmartEdit Setup Instructions for Spartacus</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/personalization-setup-instructions-for-spartacus/" class="">Personalization Setup Instructions for Spartacus</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/spartacussampledataaddon/" class="">Spartacussampledataaddon AddOn</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/integrations/" class="">Integrations ➢</a>
 
              

              
                <ul>
                  
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                 </ul>
                 
             </li>
           
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Storefront Development Guide</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/spartacus-docs/1.x/storefront-development-faq/" class="">Storefront Development FAQ</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/spartacus-api/" class="">Spartacus API</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/global-configuration-in-spartacus/" class="">Global Configuration in Spartacus</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/spartacus-features/" class="">Spartacus Features ➢</a>
 
              

              
                <ul>
                  
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                 </ul>
                 
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/security-best-practices/" class="">Security Best Practices</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/performance/" class="">Performance Optimizations ➢</a>
 
              

              
                <ul>
                  
                    

                     
                   
                    

                     
                   
                 </ul>
                 
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/outlets/" class="">Outlets</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/styling-and-page-layout/" class="">Styling and Page Layout ➢</a>
 
              

              
                <ul>
                  
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                 </ul>
                 
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/customizing-and-extending/" class="">Customizing and Extending Spartacus Features ➢</a>
 
              

              
                <ul>
                  
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                 </ul>
                 
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/extending-checkout/" class="">Extending Checkout</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/express-checkout/" class="">Express Checkout</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/guest-checkout/" class="">Guest Checkout</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/configurable-routing/" class="">Configurable Routing ➢</a>
 
              

              
                <ul>
                  
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                 </ul>
                 
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/configuring-base-url/" class="">Configuring the Base URL</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/context-configuration/" class="">Multi-Site Configuration ➢</a>
 
              

              
                <ul>
                  
                    
                      
                        

                          
                          

                          
                          
      
                          <li><a href="/spartacus-docs/1.x/automatic-context-configuration/" class="active">Automatic Multi-Site Configuration</a></li>
                    
                         

                          
                          

                          
                          
      
                          <li><a href="/spartacus-docs/1.x/static-context-configuration/" class="">Static Multi-Site Configuration</a></li>
                    
                         
                       
                     

                     
                   
                    

                     
                   
                 </ul>
                 
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/pwa-home/" class="">PWA ➢</a>
 
              

              
                <ul>
                  
                    

                     
                   
                    

                     
                   
                 </ul>
                 
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/seo/" class="">SEO ➢</a>
 
              

              
                <ul>
                  
                    

                     
                   
                    

                     
                   
                 </ul>
                 
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/i18n/" class="">Internationalization (i18n)</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/state-management/" class="">State Management ➢</a>
 
              

              
                <ul>
                  
                    

                     
                   
                 </ul>
                 
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/smartedit-contract/" class="">SmartEdit Contract in Spartacus</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/customizing-backend-communication/" class="">Customizing Back End Communication ➢</a>
 
              

              
                <ul>
                  
                    

                     
                   
                    

                     
                   
                 </ul>
                 
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/global-messages/" class="">Global Messages</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/http-error-handling/" class="">HTTP Error Handling</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/configurable-state-persistence-and-rehydration/" class="">Configurable State Persistence and Rehydration</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/server-side-rendering-in-spartacus/" class="">Server-Side Rendering ➢</a>
 
              

              
                <ul>
                  
                    

                     
                   
                    

                     
                   
                 </ul>
                 
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/view-configuration/" class="">View Configuration ➢</a>
 
              

              
                <ul>
                  
                    

                     
                   
                 </ul>
                 
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/user-experience-guidelines/" class="">User Experience Guidelines ➢</a>
 
              

              
                <ul>
                  
                    

                     
                   
                    

                     
                   
                    

                     
                   
                 </ul>
                 
             </li>
           
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Contributing to Spartacus</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/spartacus-docs/1.x/contributors-guide/" class="">Contributor's Guide ➢</a>
 
              

              
                <ul>
                  
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                 </ul>
                 
             </li>
           
        </ul>
        
      </li>
    
  </ul>
</nav>
    
  
  </div>


  <div class="archive">
    
      <h1 id="page-title" class="page__title">Automatic Multi-Site Configuration</h1>
    
    
<p><b>Note: </b> 
This feature is introduced with version 1.3 of the Spartacus libraries.
 </p>

<p>Every site that is defined in the CMS has its own context, which includes a base site ID, language properties, and currency properties. The context also defines how these attributes are persisted in the URL. You can allow Spartacus to automatically determine the context based on the URL patterns of your sites, as defined in the CMS. You can enable automatic context configuration by simply not defining the <code class="language-plaintext highlighter-rouge">context.baseSite</code> property in <code class="language-plaintext highlighter-rouge">app.module.ts</code>.</p>

<p>Before the application is initialized, Spartacus gets a list of the base sites from the back end, compares the current URL with the URL patterns of the sites that are defined in the CMS, and then identifies the current base site, along with its languages, currencies, and URL encoding attributes.</p>

<h2 id="mitigating-the-initial-back-end-call">Mitigating the Initial Back End Call</h2>

<p>The initial call to the back end for base sites can be slow, which affects the user experience. To address this, you can choose to cache the context using server-side rendering (SSR) or progressive web application (PWA) techniques.</p>

<h3 id="caching-the-site-context-with-server-side-rendering">Caching the Site Context with Server-Side Rendering</h3>

<p>The site can be identified during server-side rendering, and the context can be transferred to the browser using the Angular <code class="language-plaintext highlighter-rouge">TransferState</code> mechanism. To avoid making calls for base sites on the server side with every page request, the pages can be cached using a reverse proxy.</p>

<p>To allow the site to be identified on the server side, you need to provide the current request URL to Spartacus. You can do this by using the Spartacus decorator of the <code class="language-plaintext highlighter-rouge">ngExpressEngine</code>, which provides the <code class="language-plaintext highlighter-rouge">SERVER_REQUEST_URL</code> injection token under the hood. You can configure this in <code class="language-plaintext highlighter-rouge">main.server.ts</code>, as follows:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">ngExpressEngine</span> <span class="k">as</span> <span class="nx">engine</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@nguniversal/express-engine</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">NgExpressEngineDecorator</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@spartacus/core</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">ngExpressEngine</span> <span class="o">=</span> <span class="nx">NgExpressEngineDecorator</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">engine</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="caching-the-back-end-response-with-base-sites-in-pwa">Caching the Back End Response with Base Sites in PWA</h3>

<p>When using PWA, the back end response that provides the base sites can be cached by the Angular service worker, by adding a configuration to the <code class="language-plaintext highlighter-rouge">dataGroups</code> array in your service worker configuration. The following is an example from <code class="language-plaintext highlighter-rouge">ngsw-config.json</code>:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="err">//</span><span class="w"> </span><span class="err">...</span><span class="w">
  </span><span class="nl">"dataGroups"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="err">//</span><span class="w"> </span><span class="err">...</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"basesites"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"urls"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"*/rest/v2/basesites?fields=baseSites</span><span class="se">\\</span><span class="s2">(uid,defaultLanguage</span><span class="se">\\</span><span class="s2">(isocode</span><span class="se">\\</span><span class="s2">),urlEncodingAttributes,urlPatterns,stores</span><span class="se">\\</span><span class="s2">(currencies</span><span class="se">\\</span><span class="s2">(isocode</span><span class="se">\\</span><span class="s2">),defaultCurrency</span><span class="se">\\</span><span class="s2">(isocode</span><span class="se">\\</span><span class="s2">),languages</span><span class="se">\\</span><span class="s2">(isocode</span><span class="se">\\</span><span class="s2">),defaultLanguage</span><span class="se">\\</span><span class="s2">(isocode</span><span class="se">\\</span><span class="s2">)</span><span class="se">\\</span><span class="s2">)</span><span class="se">\\</span><span class="s2">)*"</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"cacheConfig"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"maxSize"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nl">"maxAge"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1d"</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">Set</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="err">day.</span><span class="w"> </span><span class="err">Customize</span><span class="w"> </span><span class="err">this</span><span class="w"> </span><span class="err">value</span><span class="w"> </span><span class="err">according</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">your</span><span class="w"> </span><span class="err">needs.</span><span class="w">
        </span><span class="nl">"strategy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"performance"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>In the example above, the <code class="language-plaintext highlighter-rouge">maxAge</code> shows a value of one day. You can customize this value according to your needs.</p>

<p>Note that you need to escape any parentheses with double backslashes <code class="language-plaintext highlighter-rouge">\\</code>, as shown in the <code class="language-plaintext highlighter-rouge">urls</code> configuration above. Also note that if you customize the endpoint URL in your application, you need to reflect this in the <code class="language-plaintext highlighter-rouge">urls</code> configuration.</p>

<p>For more information, see the official <a href="https://angular.io/guide/service-worker-config#datagroups">Angular service worker configuration</a> documentation.</p>

<h2 id="important-notes">Important Notes</h2>

<h3 id="base-sites-and-storefronts">Base Sites and Storefronts</h3>

<p>When the base site is encoded in the URL parameters, Spartacus refers to the <code class="language-plaintext highlighter-rouge">baseSite</code> parameter, while the CMS refers to this parameter as a <code class="language-plaintext highlighter-rouge">storefront</code>. You should continue to use the <code class="language-plaintext highlighter-rouge">storefront</code> parameter name in the CMS, because Spartacus implicitly maps <code class="language-plaintext highlighter-rouge">storefront</code> to <code class="language-plaintext highlighter-rouge">baseSite</code>. Other parameters, such as <code class="language-plaintext highlighter-rouge">language</code> and <code class="language-plaintext highlighter-rouge">currency</code>, are not affected.</p>

<h3 id="writing-url-patterns-in-java">Writing URL Patterns in Java</h3>

<p>For historical reasons, regular expressions with URL patterns that are defined in the CMS are written in Java. However, these regular expressions are evaluated on the front end using JavaScript. You should continue to use Java regex in the CMS, and they will be implicitly converted to JavaScript in Spartacus. For example, for case-insensitivity, modifiers such as <code class="language-plaintext highlighter-rouge">(?i)</code> are mapped to <code class="language-plaintext highlighter-rouge">/i</code>.</p>

<p><strong>Note</strong> Although the existing mapping between Java regex and JavaScript should suffice for the most common cases, not all Java regex features are available in JavaScript, so it is important to verify that your URL patterns do not use Java regex features that are not available in JavaScript. Otherwise, any base site with the wrong URL pattern will not be recognized by Spartacus.</p>

<p>For more information, see this comparison of regular expression engines in <a href="https://en.wikipedia.org/wiki/Comparison_of_regular_expression_engines#Language_features">Wikipedia</a>, and also look at the implementation of the <code class="language-plaintext highlighter-rouge">JavaRegExpConverter</code> service in Spartacus.</p>

<h3 id="disabling-a-base-site">Disabling a Base Site</h3>

<p>The back end endpoint returns a list of all base sites, without any information about whether the site is active or not, regardless of the options defined in the CMS, such as <code class="language-plaintext highlighter-rouge">active</code>, <code class="language-plaintext highlighter-rouge">activeFrom</code>, or <code class="language-plaintext highlighter-rouge">activeTo</code>. To disable a base site, you must remove the URL patterns for that base site.</p>

<p>As an alternative, low-level workaround, you can set restrictions for calls to the database in the back end to filter only <code class="language-plaintext highlighter-rouge">active</code> sites.</p>

<h2 id="local-development">Local Development</h2>

<p>When Spartacus identifies the site from the URL, it is often the case that the URL is not <code class="language-plaintext highlighter-rouge">localhost:4200</code> (which is the default URL for <code class="language-plaintext highlighter-rouge">ng serve</code>), but something more complex, such as <code class="language-plaintext highlighter-rouge">electronics.localhost:4200</code>. In this case, consider the following:</p>

<ul>
  <li>the URL patterns defined in the CMS need to take into account that the port <code class="language-plaintext highlighter-rouge">:4200</code> is also a part of the URL</li>
  <li>your operating system needs to know the IP of the custom domains (such as <code class="language-plaintext highlighter-rouge">127.0.0.1 electronics.localhost</code>), which you must add to your <code class="language-plaintext highlighter-rouge">hosts</code> file</li>
  <li>
    <p>the local Webpack dev server needs to allow for domains other than <code class="language-plaintext highlighter-rouge">localhost</code>, so you need to pass either the <code class="language-plaintext highlighter-rouge">host</code> flag or the <code class="language-plaintext highlighter-rouge">disable-host-check</code> flag to the <code class="language-plaintext highlighter-rouge">ng serve</code> command. Otherwise the Webpack dev server will display <strong>Invalid Host Header</strong> in the browser. The following are examples:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">ng serve --host electronics.localhost</code></li>
      <li><code class="language-plaintext highlighter-rouge">ng serve --disable-host-check</code></li>
    </ul>
  </li>
</ul>

<h2 id="how-to-add-custom-context-draft">How to add custom context (DRAFT)</h2>

<p>The site context persisted in the URL might be something different than a simply an isocode of currency or language. For example it can be a formatted language (using uppercase letters, or with underscores instead of dashes). Then a custom service <code class="language-plaintext highlighter-rouge">SiteContext&lt;T&gt;</code> can be implemented. It needs to be registered in <code class="language-plaintext highlighter-rouge">ContextServiceMap</code> and reflected in the config of <code class="language-plaintext highlighter-rouge">context</code> and <code class="language-plaintext highlighter-rouge">context.urlParameters</code>.</p>

<p>Here is an example code of a custom site context that is simply the language isocode, but formatted uppercase.</p>

<p>The implementation of custom context service:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">function</span> <span class="nx">languageToCustom</span><span class="p">(</span><span class="nx">lang</span><span class="p">:</span> <span class="nx">string</span><span class="p">):</span> <span class="nx">string</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">lang</span> <span class="o">&amp;&amp;</span> <span class="nx">lang</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">custom2Language</span><span class="p">(</span><span class="nx">country</span><span class="p">:</span> <span class="nx">string</span><span class="p">):</span> <span class="nx">string</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">country</span> <span class="o">&amp;&amp;</span> <span class="nx">country</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>
<span class="p">}</span>

<span class="p">@</span><span class="nd">Injectable</span><span class="p">({</span> <span class="na">providedIn</span><span class="p">:</span> <span class="dl">'</span><span class="s1">root</span><span class="dl">'</span> <span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">CustomContextService</span> <span class="kr">implements</span> <span class="nx">SiteContext</span><span class="o">&lt;</span><span class="nx">string</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="kr">protected</span> <span class="na">langService</span><span class="p">:</span> <span class="nx">LanguageService</span><span class="p">)</span> <span class="p">{}</span>

  <span class="nx">getActive</span><span class="p">():</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">string</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">langService</span><span class="p">.</span><span class="nx">getActive</span><span class="p">().</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">map</span><span class="p">(</span><span class="nx">languageToCustom</span><span class="p">));</span>
  <span class="p">}</span>

  <span class="nx">setActive</span><span class="p">(</span><span class="na">country</span><span class="p">:</span> <span class="nx">string</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">langService</span><span class="p">.</span><span class="nx">setActive</span><span class="p">(</span><span class="nx">custom2Language</span><span class="p">(</span><span class="nx">country</span><span class="p">));</span>
  <span class="p">}</span>

  <span class="nx">getAll</span><span class="p">():</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">string</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">langService</span>
      <span class="p">.</span><span class="nx">getAll</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
        <span class="nx">map</span><span class="p">(</span><span class="nx">languages</span> <span class="o">=&gt;</span> <span class="nx">languages</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">lang</span> <span class="o">=&gt;</span> <span class="nx">languageToCustom</span><span class="p">(</span><span class="nx">lang</span><span class="p">.</span><span class="nx">isocode</span><span class="p">)))</span>
      <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>If you are using automatic site configuration, additionally you need to:</p>

<ol>
  <li>Add in CMS (Backoffice) the <em>URL encoding attribute</em> named <code class="language-plaintext highlighter-rouge">custom</code>.</li>
  <li>
    <p>Extend the dynamic Spartacus configuration of <code class="language-plaintext highlighter-rouge">context</code> to contain the key <code class="language-plaintext highlighter-rouge">custom</code>:</p>

    <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
 <span class="k">export</span> <span class="kd">class</span> <span class="nx">CustomOccConfigLoaderService</span> <span class="kd">extends</span> <span class="nx">OccConfigLoaderService</span> <span class="p">{</span>
   <span class="kr">protected</span> <span class="nx">getConfigChunks</span><span class="p">(</span>
     <span class="nx">externalConfig</span><span class="p">:</span> <span class="nx">OccLoadedConfig</span>
   <span class="p">):</span> <span class="p">(</span><span class="nx">I18nConfig</span> <span class="o">|</span> <span class="nx">SiteContextConfig</span><span class="p">)[]</span> <span class="p">{</span>
     <span class="c1">// calculate config chunks</span>
     <span class="kd">const</span> <span class="nx">chunks</span> <span class="o">=</span> <span class="k">super</span><span class="p">.</span><span class="nx">getConfigChunks</span><span class="p">(</span><span class="nx">externalConfig</span><span class="p">);</span>

     <span class="c1">// take the chunk with SiteContextConfig (which is the first one in the array)</span>
     <span class="kd">const</span> <span class="nx">contextConfig</span> <span class="o">=</span> <span class="p">(</span><span class="nx">chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">as</span> <span class="nx">SiteContextConfig</span><span class="p">).</span><span class="nx">context</span><span class="p">;</span>

     <span class="c1">// define possible values of custom context deriving from languages' iso codes</span>
     <span class="nx">contextConfig</span><span class="p">.</span><span class="nx">custom</span> <span class="o">=</span> <span class="nx">contextConfig</span><span class="p">[</span><span class="nx">LANGUAGE_CONTEXT_ID</span><span class="p">].</span><span class="nx">map</span><span class="p">(</span>
       <span class="nx">languageToCustom</span>
     <span class="p">);</span>

     <span class="k">return</span> <span class="nx">chunks</span><span class="p">;</span>
   <span class="p">}</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ol>

<p>Finally you need to provide the <code class="language-plaintext highlighter-rouge">ContextServiceMap</code> containing the custom context service, i.e. in your app module (if you implemented custom <code class="language-plaintext highlighter-rouge">OccConfigLoaderService</code>, it also needs being provided):</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">function</span> <span class="nx">serviceMapFactory</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="p">[</span><span class="nx">LANGUAGE_CONTEXT_ID</span><span class="p">]:</span> <span class="nx">LanguageService</span><span class="p">,</span>
    <span class="p">[</span><span class="nx">CURRENCY_CONTEXT_ID</span><span class="p">]:</span> <span class="nx">CurrencyService</span><span class="p">,</span>
    <span class="p">[</span><span class="nx">BASE_SITE_CONTEXT_ID</span><span class="p">]:</span> <span class="nx">BaseSiteService</span><span class="p">,</span>
    <span class="na">custom</span><span class="p">:</span> <span class="nx">CustomContextService</span><span class="p">,</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="p">@</span><span class="nd">NgModule</span><span class="p">({</span>
  <span class="cm">/* ... */</span>
  <span class="na">providers</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="na">provide</span><span class="p">:</span> <span class="nx">ContextServiceMap</span><span class="p">,</span>
      <span class="na">useFactory</span><span class="p">:</span> <span class="nx">serviceMapFactory</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="na">provide</span><span class="p">:</span> <span class="nx">OccConfigLoaderService</span><span class="p">,</span>
      <span class="na">useClass</span><span class="p">:</span> <span class="nx">CustomOccConfigLoaderService</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">],</span>
<span class="cm">/*...*/</span>
</code></pre></div></div>

<p>Then you should be able to see your URL with language uppercase (i.e. <code class="language-plaintext highlighter-rouge">www.site.com/EN</code>), but use standard languages in your application with lowercase.</p>

<p>Above technique can be applied to implement any custom site context.</p>


<!-- <h3 class="archive__subtitle">Recent posts</h3>




 -->

  </div>
</div>
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><div class="docsearch-container"><input type="search" id="docsearch" aria-placeholder="Enter your search term..." class="search-input" tabindex="-1" placeholder="Enter your search term..." /></div>
    <!-- <div id="results" class="results"></div> --></div>

      </div>
    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <!-- <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    <li><a href="/spartacus-docs/1.x/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2020 Spartacus Documentation. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div> -->

      </footer>
    </div>

    
  <script src="/spartacus-docs/1.x/assets/js/main.min.js"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.8.2/js/all.js" integrity="sha384-DJ25uNYET2XCl5ZF++U8eNxPWqcKohUUBUpKGlNLMchM7q4Wjg2CUpjHLaL8yYPH" crossorigin="anonymous"></script>










    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script> 
    <script type="text/javascript"> docsearch({ 
    apiKey: 'a80d5313e9ea5b00e5004f69b9c090e9', 
    indexName: 'sap-spartacus', 
    inputSelector: '#docsearch', 
    debug: false // Set debug to true if you want to inspect the dropdown 
    }); 
    </script> 

    <script>
      anchors.options = {
      visible: 'hover',
      icon: "\uf0c1"
      };
    anchors.add();
    </script>

    </body>
</html>
