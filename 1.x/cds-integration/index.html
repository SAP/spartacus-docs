<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.4 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Context-Driven Services Integration - Spartacus Documentation</title>
<meta name="description" content="SAP Spartacus JavaScript Storefront Documentation.">



<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Spartacus Documentation">
<meta property="og:title" content="Context-Driven Services Integration">
<meta property="og:url" content="/spartacus-docs/1.x/cds-integration/">












  

  


<link rel="canonical" href="/spartacus-docs/1.x/cds-integration/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": null,
      "url": null,
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/spartacus-docs/1.x/feed.xml" type="application/atom+xml" rel="alternate" title="Spartacus Documentation Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/spartacus-docs/1.x/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert scripts for adding anchor links to headers -->

<script src="https://kit.fontawesome.com/82d5a2bf2f.js" crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js"></script>
<script>
  anchors.add();
</script>

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" /> 
  </head>

  <body class="layout--home">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/spartacus-docs/1.x/"><img src="/spartacus-docs/1.x/assets/images/logo-blue_64x64.png" alt=""></a>
        
        <a class="site-title" href="/spartacus-docs/1.x/">Spartacus Documentation</a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/spartacus-docs/1.x/docs-archive/" >Doc Archive</a>
            </li><li class="masthead__menu-item">
              <a href="https://join.slack.com/t/spartacus-storefront/shared_invite/enQtNDM1OTI3OTMwNjU5LTg1NGVjZmFkZjQzODc1MzFhMjc3OTZmMzIzYzg0YjMwODJiY2YxYjA5MTE5NjVmN2E5NjMxNjEzMGNlMDRjMjU" >Feedback</a>
            </li><li class="masthead__menu-item">
              <a href="https://stackoverflow.com/questions/tagged/spartacus-storefront" >Support</a>
            </li><li class="masthead__menu-item">
              <a href="/spartacus-docs/1.x/release-information/" >Version 1.5</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle menu</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">Home</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/spartacus-docs/1.x/" class="">About Spartacus</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/release-information/" class="">Release Information ➢</a>
 
              

              
                <ul>
                  
                    

                     
                   
                 </ul>
                 
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/spartacus-videos/" class="">Spartacus Videos</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/spartacus-roadmap/" class="">Spartacus Roadmap</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/spartacus-faq/" class="">Spartacus FAQ</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/docs-archive/" class="">Documentation Archive</a>
 
              

                
             </li>
           
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Getting Started with Spartacus Libraries</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/spartacus-docs/1.x/installing-sap-commerce-cloud/" class="">Installing SAP Commerce Cloud for use with Spartacus ➢</a>
 
              

              
                <ul>
                  
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                 </ul>
                 
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/cors/" class="">Cross-Origin Resource Sharing (CORS)</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/building-the-spartacus-storefront-from-libraries/" class="">Building the Spartacus Storefront from Libraries</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/recommended-development-environment/" class="">Recommended Development Environment</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/snapshot-builds/" class="">Snapshot Builds</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/configuring-feature-flags/" class="">Configuring Feature Flags</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/smartEdit-setup-instructions-for-spartacus/" class="">SmartEdit Setup Instructions for Spartacus</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/personalization-setup-instructions-for-spartacus/" class="">Personalization Setup Instructions for Spartacus</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/spartacussampledataaddon/" class="">Spartacussampledataaddon AddOn</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/integrations/" class="">Integrations ➢</a>
 
              

              
                <ul>
                  
                    
                      
                        

                          
                          

                          
                          
      
                          <li><a href="/spartacus-docs/1.x/cds-integration/" class="active">Context-Driven Services Integration</a></li>
                    
                         

                          
                          

                          
                          
      
                          <li><a href="/spartacus-docs/1.x/cybersource-integration/" class="">Payment Integration with CyberSource Example</a></li>
                    
                         

                          
                          

                          
                          
      
                          <li><a href="/spartacus-docs/1.x/kyma-integration/" class="">Kyma Integration</a></li>
                    
                         

                          
                          

                          
                          
      
                          <li><a href="/spartacus-docs/1.x/qualtrics-integration/" class="">Qualtrics Integration</a></li>
                    
                         
                       
                     

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                 </ul>
                 
             </li>
           
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Storefront Development Guide</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/spartacus-docs/1.x/storefront-development-faq/" class="">Storefront Development FAQ</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/spartacus-api/" class="">Spartacus API</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/global-configuration-in-spartacus/" class="">Global Configuration in Spartacus</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/spartacus-features/" class="">Spartacus Features ➢</a>
 
              

              
                <ul>
                  
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                 </ul>
                 
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/security-best-practices/" class="">Security Best Practices</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/performance/" class="">Performance Optimizations ➢</a>
 
              

              
                <ul>
                  
                    

                     
                   
                    

                     
                   
                 </ul>
                 
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/outlets/" class="">Outlets</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/styling-and-page-layout/" class="">Styling and Page Layout ➢</a>
 
              

              
                <ul>
                  
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                 </ul>
                 
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/customizing-and-extending/" class="">Customizing and Extending Spartacus Features ➢</a>
 
              

              
                <ul>
                  
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                 </ul>
                 
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/extending-checkout/" class="">Extending Checkout</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/express-checkout/" class="">Express Checkout</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/guest-checkout/" class="">Guest Checkout</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/configurable-routing/" class="">Configurable Routing ➢</a>
 
              

              
                <ul>
                  
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                 </ul>
                 
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/configuring-base-url/" class="">Configuring the Base URL</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/context-configuration/" class="">Multi-Site Configuration ➢</a>
 
              

              
                <ul>
                  
                    

                     
                   
                    

                     
                   
                 </ul>
                 
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/pwa-home/" class="">PWA ➢</a>
 
              

              
                <ul>
                  
                    

                     
                   
                    

                     
                   
                 </ul>
                 
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/seo/" class="">SEO ➢</a>
 
              

              
                <ul>
                  
                    

                     
                   
                    

                     
                   
                 </ul>
                 
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/i18n/" class="">Internationalization (i18n)</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/state-management/" class="">State Management ➢</a>
 
              

              
                <ul>
                  
                    

                     
                   
                 </ul>
                 
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/smartedit-contract/" class="">SmartEdit Contract in Spartacus</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/customizing-backend-communication/" class="">Customizing Back End Communication ➢</a>
 
              

              
                <ul>
                  
                    

                     
                   
                    

                     
                   
                 </ul>
                 
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/global-messages/" class="">Global Messages</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/http-error-handling/" class="">HTTP Error Handling</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/configurable-state-persistence-and-rehydration/" class="">Configurable State Persistence and Rehydration</a>
 
              

                
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/server-side-rendering-in-spartacus/" class="">Server-Side Rendering ➢</a>
 
              

              
                <ul>
                  
                    

                     
                   
                    

                     
                   
                 </ul>
                 
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/view-configuration/" class="">View Configuration ➢</a>
 
              

              
                <ul>
                  
                    

                     
                   
                 </ul>
                 
             </li>
           
            
            

            
            

            <li><a href="/spartacus-docs/1.x/user-experience-guidelines/" class="">User Experience Guidelines ➢</a>
 
              

              
                <ul>
                  
                    

                     
                   
                    

                     
                   
                    

                     
                   
                 </ul>
                 
             </li>
           
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Contributing to Spartacus</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/spartacus-docs/1.x/contributors-guide/" class="">Contributor's Guide ➢</a>
 
              

              
                <ul>
                  
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                    

                     
                   
                 </ul>
                 
             </li>
           
        </ul>
        
      </li>
    
  </ul>
</nav>
    
  
  </div>


  <div class="archive">
    
      <h1 id="page-title" class="page__title">Context-Driven Services Integration</h1>
    
    
<p><b>Note: </b> 
This feature is introduced with version 1.5 of the Spartacus libraries.
 </p>

<h2 id="overview">Overview</h2>

<p>The SAP Commerce Cloud, Context-Driven Services solution provides real-time customer experience personalization for SAP Commerce. You can integrate Context-Driven Services with your Spartacus Storefront, including the Profile Tag and the Merchandising Carousel features.</p>

<p>For more information, see <a href="https://help.sap.com/viewer/product/CONTEXT-DRIVEN_SERVICES/SHIP/en-US">SAP Commerce Cloud, Context-Driven Services</a> on the SAP Help Portal.</p>

<h2 id="requirements">Requirements</h2>

<p>To integrate Context-Driven Services with Spartacus, release <strong>1905.9</strong> of Commerce Cloud is required.</p>

<p>Also, the Anonymous Consent feature in Spartacus needs to be enabled. For more information, see <a href="/spartacus-docs/1.x/anonymous-consent/">Anonymous Consent</a>.</p>

<h2 id="enabling-context-driven-services-in-spartacus">Enabling Context-Driven Services in Spartacus</h2>

<p>To enable Context-Driven Services in Spartacus, you need to configure both the Commerce Cloud back end, and the Spartacus front end.</p>

<h3 id="configuring-the-back-end-for-context-driven-services">Configuring the Back End for Context-Driven Services</h3>

<p>The following steps describe how to add custom headers to your CORS settings, as well as how to define a consent template that allows events to be sent.</p>

<ol>
  <li>
    <p>Add the <code class="language-plaintext highlighter-rouge">x-profile-tag-debug</code> and <code class="language-plaintext highlighter-rouge">x-consent-reference</code> custom headers to <code class="language-plaintext highlighter-rouge">corsfilter.commercewebservices.allowedHeaders</code>.</p>

    <p>If you are using the Assisted Service Module, add these custom headers to <code class="language-plaintext highlighter-rouge">corsfilter.assistedservicewebservices.allowedHeaders</code> as well.</p>

    <p><strong>Note:</strong> The <code class="language-plaintext highlighter-rouge">corsfilter.commercewebservices.allowedHeaders</code> setting is for SAP Commerce Cloud version 2005 or newer. For SAP Commerce Cloud version 1905 or older, use <code class="language-plaintext highlighter-rouge">corsfilter.ycommercewebservices.allowedHeaders</code> instead.</p>

    <p>For more information, see <a href="https://sap.github.io/spartacus-docs/installing-sap-commerce-cloud/#configuring-cors">Configuring CORS</a>.</p>
  </li>
  <li>
    <p>Define a consent template with an ID of <code class="language-plaintext highlighter-rouge">PROFILE</code>, which will allow events to be sent.</p>

    <p>You can define the consent template by importing the following ImpEx:</p>

    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="err">$</span><span class="n">lang</span><span class="o">=</span><span class="n">en</span>
 <span class="n">INSERT_UPDATE</span> <span class="n">ConsentTemplate</span><span class="p">;</span><span class="n">id</span><span class="p">[</span><span class="k">unique</span><span class="o">=</span><span class="k">true</span><span class="p">];</span><span class="n">name</span><span class="p">[</span><span class="n">lang</span><span class="o">=</span><span class="err">$</span><span class="n">lang</span><span class="p">];</span><span class="n">description</span><span class="p">[</span><span class="n">lang</span><span class="o">=</span><span class="err">$</span><span class="n">lang</span><span class="p">];</span><span class="k">version</span><span class="p">[</span><span class="k">unique</span><span class="o">=</span><span class="k">true</span><span class="p">];</span><span class="n">baseSite</span><span class="p">(</span><span class="n">uid</span><span class="p">)[</span><span class="k">unique</span><span class="o">=</span><span class="k">true</span><span class="p">,</span>    <span class="k">default</span><span class="o">=</span><span class="n">electronics</span><span class="o">-</span><span class="n">spa</span><span class="p">];</span><span class="n">exposed</span>
 <span class="p">;</span><span class="n">PROFILE</span><span class="p">;</span><span class="nv">"Allow SAP Commerce Cloud, Context-Driven Services tracking"</span><span class="p">;</span><span class="nv">"We would like to store your browsing behavior so that our website can dynamically present you with a personalized browsing experience and our customer support agents can provide you with contextual customer support."</span><span class="p">;</span><span class="mi">1</span><span class="p">;;</span><span class="k">true</span>
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="configuring-spartacus-for-context-driven-services">Configuring Spartacus for Context-Driven Services</h3>

<p>You can carry out all of the following steps after you have set up your Spartacus Storefront. For more information, see <a href="/spartacus-docs/1.x/building-the-spartacus-storefront-from-libraries/">Building the Spartacus Storefront from Libraries</a>.</p>

<ol>
  <li>
    <p>Install the Context-Driven Services library by running the following command from within the root directory of your storefront app:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> npm i @spartacus/cds
</code></pre></div>    </div>
  </li>
  <li>
    <p>Import the Context-Driven Services module by adding the following line below the existing import statements at the top of <code class="language-plaintext highlighter-rouge">app.module.ts</code>:</p>

    <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">import</span> <span class="p">{</span> <span class="nx">CdsModule</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@spartacus/cds</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Add the <code class="language-plaintext highlighter-rouge">CdsModule</code> to <code class="language-plaintext highlighter-rouge">app.module.ts</code>.</p>

    <p>The following is an example:</p>

    <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="p">@</span><span class="nd">NgModule</span><span class="p">({</span>
   <span class="na">imports</span><span class="p">:</span> <span class="p">[</span>
     <span class="nx">CdsModule</span><span class="p">.</span><span class="nx">forRoot</span><span class="p">({</span>
       <span class="na">cds</span><span class="p">:</span> <span class="p">{</span>
         <span class="na">tenant</span><span class="p">:</span> <span class="dl">'</span><span class="s1">my-tenant</span><span class="dl">'</span><span class="p">,</span>
         <span class="na">baseUrl</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https://api.us.context.cloud.sap</span><span class="dl">'</span><span class="p">,</span>
         <span class="na">endpoints</span><span class="p">:</span> <span class="p">{</span>
           <span class="na">strategyProducts</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/strategy/${tenant}/strategies/${strategyId}/products</span><span class="dl">'</span><span class="p">,</span>
         <span class="p">},</span>
         <span class="na">merchandising</span><span class="p">:</span> <span class="p">{</span>
           <span class="na">defaultCarouselViewportThreshold</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
         <span class="p">}</span>
         <span class="nl">profileTag</span><span class="p">:</span> <span class="p">{</span>
           <span class="na">javascriptUrl</span><span class="p">:</span> <span class="dl">'</span><span class="s1">https://tag.static.us.context.cloud.sap/js/profile-tag.js</span><span class="dl">'</span><span class="p">,</span>
           <span class="na">configUrl</span><span class="p">:</span>
             <span class="dl">'</span><span class="s1">https://tag.static.stage.context.cloud.sap/config/my-config123</span><span class="dl">'</span><span class="p">,</span>
         <span class="p">},</span>
       <span class="p">},</span>
     <span class="p">}),</span>
     <span class="p">...</span>
</code></pre></div>    </div>
    <p>The following is a summary of the parameters of the <code class="language-plaintext highlighter-rouge">CdsModule</code>:</p>

    <ul>
      <li><strong>tenant:</strong> Set this to your testing or production tenant, as required. For more information, see <a href="https://help.sap.com/viewer/4c392ae9f85b412cac24f5618fe7fc0a/SHIP/en-US/9001aa58037747b9a5dcd788bf67d237.html">Tenant Provisioning</a>.</li>
      <li><strong>baseUrl:</strong> Replace the value shown in the example with the base URL of your Context-Driven Services environment.</li>
      <li><strong>strategyProducts:</strong> Set this value as shown in the example.</li>
      <li><strong>defaultCarouselViewportThreshold:</strong> With Commerce Cloud 1905.14 or newer, you can configure the percentage of the merchandising carousel that needs to be in the viewport for carousel view events to be sent to Context-Driven Services. If you are using an older version of Commerce Cloud, you can use this setting to provide the same functionality, but it will be applied to all carousels in the storefront, rather than individual carousels that you specify. If no value is provided, a default of 80% is used. In this case, 80% of the carousel needs to be in the viewport for view events to trigger.</li>
      <li><strong>javascriptUrl:</strong> Specify the URL of the Profile Tag version you wish to use. It is recommended that you use the URL for the latest version of Profile Tag (for example, <code class="language-plaintext highlighter-rouge">http://tag.static.us.context.cloud.sap/js/profile-tag.js</code>). For more information, see <a href="https://help.sap.com/viewer/9e39964ec48c4335ad5d3d01f9d231fd/SHIP/en-US/2f49c91ca16344de951921e1be50c025.html">Deciding Which Profile Tag Link to Use</a> on the SAP Help Portal.</li>
      <li><strong>configUrl:</strong> Specify the URL of the Profile Tag configuration that you have created in Context-Driven Services. For more information, see <a href="https://help.sap.com/viewer/9e39964ec48c4335ad5d3d01f9d231fd/SHIP/en-US/44cb2bd7706a48c6a3b915078d2c384d.html">Profile Tag Overview</a> on the SAP Help Portal.</li>
      <li><strong>allowInsecureCookies:</strong> This is an optional parameter (not show in the example above) that specifies whether Profile Tag should set insecure cookies. The default value is <code class="language-plaintext highlighter-rouge">false</code>. If you are running on HTTP, set this parameter to <code class="language-plaintext highlighter-rouge">true</code>. For example, if you are using a local back end, <code class="language-plaintext highlighter-rouge">allowInsecureCookies</code> must be set to <code class="language-plaintext highlighter-rouge">true</code>. In production, it should always be set to <code class="language-plaintext highlighter-rouge">false</code>.</li>
      <li><strong>gtmId:</strong> This is an optional parameter (not show in the example above) that is used to integrate Profile Tag with Google Tag Manager. For more information, see <a href="https://help.sap.com/viewer/9e39964ec48c4335ad5d3d01f9d231fd/SHIP/en-US/3bccaa4bd20441fd88dcfc1ade648591.html">Profile Tag</a> on the SAP Help Portal.</li>
    </ul>
  </li>
</ol>

<h2 id="profile-tag">Profile Tag</h2>

<p>To enable Profile Tag, create a CMSFlexComponent called <code class="language-plaintext highlighter-rouge">ProfileTagComponent</code> in the catalog, and place it in the footer. You can do this by importing the following ImpEx:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span><span class="n">contentCatalog</span><span class="o">=</span><span class="n">electronics</span><span class="o">-</span><span class="n">spaContentCatalog</span>
<span class="err">$</span><span class="n">contentCV</span><span class="o">=</span><span class="n">catalogVersion</span><span class="p">(</span><span class="n">CatalogVersion</span><span class="p">.</span><span class="k">catalog</span><span class="p">(</span><span class="k">Catalog</span><span class="p">.</span><span class="n">id</span><span class="p">[</span><span class="k">default</span><span class="o">=</span><span class="err">$</span><span class="n">contentCatalog</span><span class="p">]),</span><span class="n">CatalogVersion</span><span class="p">.</span><span class="k">version</span><span class="p">[</span><span class="k">default</span><span class="o">=</span><span class="n">Staged</span><span class="p">])[</span><span class="k">default</span><span class="o">=</span><span class="err">$</span><span class="n">contentCatalog</span><span class="p">:</span><span class="n">Staged</span><span class="p">]</span>
<span class="n">INSERT_UPDATE</span> <span class="n">CMSFlexComponent</span><span class="p">;</span><span class="err">$</span><span class="n">contentCV</span><span class="p">[</span><span class="k">unique</span><span class="o">=</span><span class="k">true</span><span class="p">];</span><span class="n">uid</span><span class="p">[</span><span class="k">unique</span><span class="o">=</span><span class="k">true</span><span class="p">];</span><span class="n">name</span><span class="p">;</span><span class="n">flexType</span><span class="p">;</span><span class="o">&amp;</span><span class="n">componentRef</span><span class="p">;</span>
<span class="p">;;</span><span class="n">ProfileTagComponent</span><span class="p">;</span><span class="n">ProfileTag</span> <span class="n">Spartacus</span> <span class="n">Component</span><span class="p">;</span><span class="n">ProfileTagComponent</span><span class="p">;</span><span class="n">ProfileTagComponent</span><span class="p">;</span>

<span class="n">INSERT_UPDATE</span> <span class="n">ContentSlot</span><span class="p">;</span><span class="err">$</span><span class="n">contentCV</span><span class="p">[</span><span class="k">unique</span><span class="o">=</span><span class="k">true</span><span class="p">];</span><span class="n">uid</span><span class="p">[</span><span class="k">unique</span><span class="o">=</span><span class="k">true</span><span class="p">];</span><span class="n">cmsComponents</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="err">$</span><span class="n">contentCV</span><span class="p">)[</span><span class="k">mode</span><span class="o">=</span><span class="n">append</span><span class="p">]</span>
<span class="p">;;</span><span class="n">FooterSlot</span><span class="p">;</span><span class="n">ProfileTagComponent</span>
</code></pre></div></div>

<p>This ImpEx creates the component in the Staged catalog. To publish it, run a sync, or replace <code class="language-plaintext highlighter-rouge">Staged</code> with <code class="language-plaintext highlighter-rouge">Online</code> in the ImpEx.</p>

<h2 id="context-driven-merchandising">Context-Driven Merchandising</h2>

<p>Context-Driven Merchandising carousels enable a Spartacus storefront to display the results of Context-Driven Merchandising in the form of a product carousel.</p>

<p>For more information, see <a href="https://help.sap.com/viewer/26c27f420a2946e19aaf1518849f932d/SHIP/en-US/fda52c18718648dcbd57515e7c6fefaf.html">Context-Driven Merchandising</a> and <a href="https://help.sap.com/viewer/50c996852b32456c96d3161a95544cdb/latest/en-US/3bf7fa520667450499d3e04560659568.html">Context-Driven Merchandising Module</a> on the SAP Help Portal.</p>

<h3 id="requirements-for-enabling-context-driven-merchandising">Requirements for Enabling Context-Driven Merchandising</h3>

<p>Context-Driven Merchandising carousels require the <code class="language-plaintext highlighter-rouge">merchandisingaddon</code> and <code class="language-plaintext highlighter-rouge">profiletagaddon</code> extensions. Once you install the extensions, follow the steps in <a href="https://help.sap.com/viewer/50c996852b32456c96d3161a95544cdb/latest/en-US/57bd76612cea4fddb2d62d2b29d0effb.html#loio57bd76612cea4fddb2d62d2b29d0effb">Merchandising Configuration Setup</a> and <a href="https://help.sap.com/viewer/50c996852b32456c96d3161a95544cdb/latest/en-US/a13f4af6daa24d66b4c9a2b0e5544160.html#loioa13f4af6daa24d66b4c9a2b0e5544160">Catalog Synchronization Configuration</a> to synchronize a product catalog with Context-Driven Services.</p>

<p>It is also recommended to follow the instructions in <a href="https://help.sap.com/viewer/50c996852b32456c96d3161a95544cdb/latest/en-US/a13f4af6daa24d66b4c9a2b0e5544160.html#loio6f59fb60a3fd43f89c08e8ba28b9e2a2">Product Directory Configuration</a>.</p>

<h3 id="adding-a-merchandising-carousel-with-impex">Adding a Merchandising Carousel with ImpEx</h3>

<p>If you know your <code class="language-plaintext highlighter-rouge">strategyId</code>, you can add a Merchandising carousel through ImpEx. The following is an example:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">#</span> <span class="n">Homepage</span> <span class="n">carousel</span>
<span class="o">#</span> <span class="k">Create</span> <span class="n">the</span> <span class="n">CMS</span> <span class="n">Component</span>
<span class="n">INSERT_UPDATE</span> <span class="n">MerchandisingCarouselComponent</span><span class="p">;</span><span class="err">$</span><span class="n">contentCV</span><span class="p">[</span><span class="k">unique</span><span class="o">=</span><span class="k">true</span><span class="p">];</span><span class="n">uid</span><span class="p">[</span><span class="k">unique</span><span class="o">=</span><span class="k">true</span><span class="p">];</span><span class="n">name</span><span class="p">;</span><span class="n">title</span><span class="p">;</span><span class="n">numberToDisplay</span><span class="p">;</span><span class="n">strategy</span><span class="p">;</span><span class="o">&amp;</span><span class="n">componentRef</span>
<span class="p">;;</span><span class="n">HomepageE2EMerchandisingCarousel</span><span class="p">;</span><span class="n">Homepage</span> <span class="n">E2E</span> <span class="n">Merchandising</span> <span class="n">Carousel</span><span class="p">;</span><span class="n">Homepage</span> <span class="n">E2E</span> <span class="n">Merchandising</span> <span class="n">Carousel</span><span class="p">;</span><span class="mi">10</span><span class="p">;</span><span class="mi">00000000</span><span class="o">-</span><span class="mi">0000</span><span class="o">-</span><span class="mi">0000</span><span class="o">-</span><span class="mi">0000</span><span class="o">-</span><span class="mi">000000000000</span><span class="p">;</span><span class="n">HomepageE2EMerchandisingCarousel</span>

<span class="o">#</span> <span class="k">Add</span> <span class="n">the</span> <span class="n">component</span> <span class="k">to</span> <span class="n">the</span> <span class="n">slot</span>
<span class="n">INSERT_UPDATE</span> <span class="n">ContentSlot</span><span class="p">;</span><span class="err">$</span><span class="n">contentCV</span><span class="p">[</span><span class="k">unique</span><span class="o">=</span><span class="k">true</span><span class="p">];</span><span class="n">uid</span><span class="p">[</span><span class="k">unique</span><span class="o">=</span><span class="k">true</span><span class="p">];</span><span class="n">cmsComponents</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="err">$</span><span class="n">contentCV</span><span class="p">)</span>
<span class="p">;;</span><span class="n">Section2CSlot</span><span class="o">-</span><span class="n">Homepage</span><span class="p">;</span><span class="n">HomepageE2EMerchandisingCarousel</span>

<span class="o">#</span> <span class="n">Category</span> <span class="n">Page</span> <span class="n">carousel</span>
<span class="o">#</span> <span class="k">Create</span> <span class="n">the</span> <span class="n">CMS</span> <span class="n">Component</span>
<span class="n">INSERT_UPDATE</span> <span class="n">MerchandisingCarouselComponent</span><span class="p">;</span><span class="err">$</span><span class="n">contentCV</span><span class="p">[</span><span class="k">unique</span><span class="o">=</span><span class="k">true</span><span class="p">];</span><span class="n">uid</span><span class="p">[</span><span class="k">unique</span><span class="o">=</span><span class="k">true</span><span class="p">];</span><span class="n">name</span><span class="p">;</span><span class="n">title</span><span class="p">;</span><span class="n">numberToDisplay</span><span class="p">;</span><span class="n">strategy</span><span class="p">;</span><span class="o">&amp;</span><span class="n">componentRef</span>
<span class="p">;;</span><span class="n">CategoryPageE2EMerchandisingCarousel</span><span class="p">;</span><span class="n">Category</span> <span class="n">Page</span> <span class="n">E2E</span> <span class="n">Merchandising</span> <span class="n">Carousel</span><span class="p">;</span><span class="n">Category</span> <span class="n">Page</span> <span class="n">E2E</span> <span class="n">Merchandising</span> <span class="n">Carousel</span><span class="p">;</span><span class="mi">10</span><span class="p">;</span><span class="mi">00000000</span><span class="o">-</span><span class="mi">0000</span><span class="o">-</span><span class="mi">0000</span><span class="o">-</span><span class="mi">0000</span><span class="o">-</span><span class="mi">000000000000</span><span class="p">;</span><span class="n">CategoryPageE2EMerchandisingCarousel</span>

<span class="o">#</span> <span class="k">Add</span> <span class="n">the</span> <span class="n">component</span> <span class="k">to</span> <span class="n">the</span> <span class="n">slot</span>
<span class="n">INSERT_UPDATE</span> <span class="n">ContentSlot</span><span class="p">;</span><span class="err">$</span><span class="n">contentCV</span><span class="p">[</span><span class="k">unique</span><span class="o">=</span><span class="k">true</span><span class="p">];</span><span class="n">uid</span><span class="p">[</span><span class="k">unique</span><span class="o">=</span><span class="k">true</span><span class="p">];</span><span class="n">cmsComponents</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="err">$</span><span class="n">contentCV</span><span class="p">)</span>
<span class="p">;;</span><span class="n">BottomHeaderSlot</span><span class="p">;</span><span class="n">CategoryPageE2EMerchandisingCarousel</span>

<span class="o">#</span> <span class="n">SLR</span> <span class="n">Page</span> <span class="n">carousel</span>
<span class="o">#</span> <span class="k">Create</span> <span class="n">the</span> <span class="n">CMS</span> <span class="n">Component</span>
<span class="n">INSERT_UPDATE</span> <span class="n">MerchandisingCarouselComponent</span><span class="p">;</span><span class="err">$</span><span class="n">contentCV</span><span class="p">[</span><span class="k">unique</span><span class="o">=</span><span class="k">true</span><span class="p">];</span><span class="n">uid</span><span class="p">[</span><span class="k">unique</span><span class="o">=</span><span class="k">true</span><span class="p">];</span><span class="n">name</span><span class="p">;</span><span class="n">title</span><span class="p">;</span><span class="n">numberToDisplay</span><span class="p">;</span><span class="n">strategy</span><span class="p">;</span><span class="o">&amp;</span><span class="n">componentRef</span>
<span class="p">;;</span><span class="n">SLRCategoryPageE2EMerchandisingCarousel</span><span class="p">;</span><span class="n">SLR</span> <span class="n">Category</span> <span class="n">Page</span> <span class="n">E2E</span> <span class="n">Merchandising</span> <span class="n">Carousel</span><span class="p">;</span><span class="n">SLR</span> <span class="n">Category</span> <span class="n">Page</span> <span class="n">E2E</span> <span class="n">Merchandising</span> <span class="n">Carousel</span><span class="p">;</span><span class="mi">10</span><span class="p">;</span><span class="mi">00000000</span><span class="o">-</span><span class="mi">0000</span><span class="o">-</span><span class="mi">0000</span><span class="o">-</span><span class="mi">0000</span><span class="o">-</span><span class="mi">000000000000</span><span class="p">;</span><span class="n">SLRCategoryPageE2EMerchandisingCarousel</span>

<span class="o">#</span> <span class="k">Add</span> <span class="n">the</span> <span class="n">component</span> <span class="k">to</span> <span class="n">the</span> <span class="n">slot</span>
<span class="n">INSERT_UPDATE</span> <span class="n">ContentSlot</span><span class="p">;</span><span class="err">$</span><span class="n">contentCV</span><span class="p">[</span><span class="k">unique</span><span class="o">=</span><span class="k">true</span><span class="p">];</span><span class="n">uid</span><span class="p">[</span><span class="k">unique</span><span class="o">=</span><span class="k">true</span><span class="p">];</span><span class="n">cmsComponents</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="err">$</span><span class="n">contentCV</span><span class="p">)</span>
<span class="p">;;</span><span class="n">SLRCamerasBottomHeaderSlot</span><span class="p">;</span><span class="n">SLRCategoryPageE2EMerchandisingCarousel</span>
</code></pre></div></div>

<p><strong>Note:</strong> The above ImpEx includes examples of locations where you can create and place the carousel in a slot, but you are not limited to these locations. You can place the CMS component in any slot that allows it.</p>

<h3 id="adding-a-merchandising-carousel-with-smartedit">Adding a Merchandising Carousel with SmartEdit</h3>

<p>If you have followed the <a href="/spartacus-docs/1.x/smartEdit-setup-instructions-for-spartacus/">SmartEdit Setup Instructions for Spartacus</a>, you can use SmartEdit to add a Context-Driven Merchandising carousel to a page, as follows:</p>

<ol>
  <li>
    <p>Launch SmartEdit.</p>
  </li>
  <li>
    <p>Edit the page you want to add a Merchandising carousel to.</p>
  </li>
  <li>
    <p>Click the <strong>+ Component</strong> button in SmartEdit.</p>

    <p>You should see the <strong>SAP CONTEXT-DRIVEN MERCHANDISING</strong> carousel component. If you do not see it, use the search box.</p>
  </li>
  <li>
    <p>Drag and drop the component onto a content slot on the page.</p>

    <p>If the component does not drop in the <strong>Basic Edit</strong> mode, switch to the <strong>Advanced Edit</strong> mode using the dropdown in SmartEdit.</p>
  </li>
  <li>
    <p>Fill in the fields of the configuration window that appears.</p>

    <p>For the <strong>Number to Display</strong> field, specify the number of products you wish to display in the carousel. If the number of products exceeds the size of the carousel, the user will need to use scrolling arrows to see all products.</p>

    <p>For the <strong>Scroll Type</strong> field, the only available scroll type is <strong>one</strong>. This enables the user to scroll the products one by one upon clicking the scrolling arrow.</p>

    <p>For the <strong>Strategy</strong> field, select a configured Merchandising strategy to be used in the carousel.</p>

    <p>For the <strong>Viewport Percentage</strong> field, enter the percentage of the carousel that needs to be in the viewport for carousel view events to be sent to Context-Driven Services.</p>

    <p><strong>Note:</strong> This configuration option is only available in Commerce Cloud version 1905.14 or newer. If you are using an older version of Commerce Cloud, you can use this setting to provide the same functionality, but it will be applied to all carousels in the storefront, rather than individual carousels that you specify.</p>
  </li>
  <li>
    <p>Click <strong>Save</strong> for the Merchandising carousel to appear on the page you are editing.</p>
  </li>
</ol>

<h2 id="context-driven-services-shell-application">Context-Driven Services Shell Application</h2>

<p><strong>Note:</strong> The Context-Driven Services Shell Application is for developers who are contributing to the Spartacus library sources. In other words, it is only available if you have cloned the Spartacus library sources and are working with a contributor set-up of Spartacus. For more information, see <a href="/spartacus-docs/1.x/contributor-setup/">Contributor Setup</a></p>

<p>The following steps describe how to run the Context-Driven Services Shell Application:</p>

<ol>
  <li>
    <p>Run the following command to execute the library builds:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> yarn build:core:lib:cds
</code></pre></div>    </div>
  </li>
  <li>
    <p>Run the following command to start the shell:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> yarn start:cds
</code></pre></div>    </div>
  </li>
  <li>
    <p>Run the following command to perform unit tests:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> yarn <span class="nb">test</span>:cds
</code></pre></div>    </div>

    <p>When you run these commands, the browser opens, and you can see the progress of the tests with detailed information, including whether the tests pass.</p>
  </li>
  <li>
    <p>Run the following command to perform end-to-end tests. You can do this either manually or automatically.</p>

    <p>To run the tests manually, run the following commands:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> yarn start:cds
 yarn e2e:cy:cds:run:vendor
</code></pre></div>    </div>

    <p><strong>Note:</strong> To run the end-to-end test in headless mode, make sure you have your Spartacus instance running before executing the end-to-end command.</p>

    <p>To run the tests automatically, run the following command:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> yarn e2e:cy:cds:start-open
</code></pre></div>    </div>

    <p><strong>Note:</strong> When using this command, you do not need to separately start a Spartacus instance; it is already done as part of the command. To run the Cypress end-to-end tests for Context-Driven Services in Spartacus, select <code class="language-plaintext highlighter-rouge">merchandising-carousel.e2e-spec.ts</code> in the Cypress user interface.</p>
  </li>
</ol>

<h2 id="other-commands-for-context-driven-services">Other Commands for Context-Driven Services</h2>

<p>All other Context-Driven Services commands have <code class="language-plaintext highlighter-rouge">:cds</code> as part of their name, and can be found in the <code class="language-plaintext highlighter-rouge">package.json</code> file of the Spartacus source code.</p>

<h2 id="limitations">Limitations</h2>

<p>Login flow is currently not fully supported.</p>


<!-- <h3 class="archive__subtitle">Recent posts</h3>




 -->

  </div>
</div>
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><div class="docsearch-container"><input type="search" id="docsearch" aria-placeholder="Enter your search term..." class="search-input" tabindex="-1" placeholder="Enter your search term..." /></div>
    <!-- <div id="results" class="results"></div> --></div>

      </div>
    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <!-- <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    <li><a href="/spartacus-docs/1.x/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2020 Spartacus Documentation. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div> -->

      </footer>
    </div>

    
  <script src="/spartacus-docs/1.x/assets/js/main.min.js"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.8.2/js/all.js" integrity="sha384-DJ25uNYET2XCl5ZF++U8eNxPWqcKohUUBUpKGlNLMchM7q4Wjg2CUpjHLaL8yYPH" crossorigin="anonymous"></script>










    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script> 
    <script type="text/javascript"> docsearch({ 
    apiKey: 'a80d5313e9ea5b00e5004f69b9c090e9', 
    indexName: 'sap-spartacus', 
    inputSelector: '#docsearch', 
    debug: false // Set debug to true if you want to inspect the dropdown 
    }); 
    </script> 

    <script>
      anchors.options = {
      visible: 'hover',
      icon: "\uf0c1"
      };
    anchors.add();
    </script>

    </body>
</html>
