<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.4 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>State Persistence - Spartacus Documentation</title>
<meta name="description" content="SAP Spartacus JavaScript Storefront Documentation.">



<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Spartacus Documentation">
<meta property="og:title" content="State Persistence">
<meta property="og:url" content="/spartacus-docs/4.x/state-persistence/">












  

  


<link rel="canonical" href="/spartacus-docs/4.x/state-persistence/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": null,
      "url": null,
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/spartacus-docs/4.x/feed.xml" type="application/atom+xml" rel="alternate" title="Spartacus Documentation Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/spartacus-docs/4.x/assets/css/main.css">
<link rel="stylesheet" href="/spartacus-docs/4.x/assets/css/keys.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert scripts for adding anchor links to headers -->

<script src="https://kit.fontawesome.com/82d5a2bf2f.js" crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js"></script>
<script>
  anchors.add();
</script>

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" /> 
  </head>

  <body class="layout--home">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/spartacus-docs/4.x/"><img src="/spartacus-docs/4.x/assets/images/logo-blue_64x64.png" alt="Spartacus logo"></a>
        
        <a class="site-title" href="/spartacus-docs/4.x/">Spartacus Documentation</a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/spartacus-docs/4.x/docs-archive/" >Doc Archive</a>
            </li><li class="masthead__menu-item">
              <a href="https://join.slack.com/t/spartacus-storefront/shared_invite/zt-jekftqo0-HP6xt6IF~ffVB2cGG66fcQ" >Feedback</a>
            </li><li class="masthead__menu-item">
              <a href="/spartacus-docs/4.x/#how-to-obtain-support" >Support</a>
            </li><li class="masthead__menu-item">
              <a href="/spartacus-docs/4.x/release-information/" >Version 4.2</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle menu</label>
  <ul class="nav__items">
    
      <li>
        
          
          

         <a href="/spartacus-docs/4.x/"><span class="nav__sub-title">Home</span></a>
         
        
            <ul>
                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
            </ul>  
      </li>          
    
      <li>
        
          
          

         <a href="/spartacus-docs/4.x/getting-started/"><span class="nav__sub-title">Getting Started with Spartacus Libraries</span></a>
         
        
            <ul>
                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
            </ul>  
      </li>          
    
      <li>
        
          
          

         <a href="/spartacus-docs/4.x/dev-guide/"><span class="nav__sub-title">Storefront Development Guide</span></a>
         
        
            <ul>
                
                        <ul>
                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                                

                                                
                                                

                                                  

                                                    <li><a href="/spartacus-docs/4.x/a11y/">Accessibility ➢</a>
                                                  
                                                            <ul>
                                                                
                                                                  
                                                                      
                                                                  
                                                                
                                                                  
                                                                      
                                                                  
                                                                      
                                                                  
                                                                      
                                                                  
                                                                      
                                                                  
                                                                      
                                                                  
                                                                      
                                                                  
                                                                
                                                            </ul>
                                                    </li>
                                                    
                                                

                                                
                                                

                                                  

                                                    <li><a href="/spartacus-docs/4.x/spartacus-api/">API</a>
                                                  
                                                            <ul>
                                                                
                                                            </ul>
                                                    </li>
                                                    
                                                

                                                
                                                

                                                  

                                                    <li><a href="/spartacus-docs/4.x/architecture/">Architecture ➢</a>
                                                  
                                                            <ul>
                                                                
                                                                  
                                                                      
                                                                  
                                                                      
                                                                  
                                                                      
                                                                  
                                                                      
                                                                  
                                                                      
                                                                  
                                                                      
                                                                  
                                                                      
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                      
                                                                  
                                                                      
                                                                  
                                                                
                                                                  
                                                                      
                                                                  
                                                                      
                                                                  
                                                                
                                                                  
                                                                      
                                                                  
                                                                      
                                                                  
                                                                      
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                      
                                                                  
                                                                    
                                                                      

                                                                        
                                                                        
                                                                        
                                                                        <li><a href="/spartacus-docs/4.x/configurable-routing/">Configurable Routing ➢</a>

                                                                          
                                                                            <ul>
                                                                              
                                                                                        
                                                                              
                                                                                        
                                                                              
                                                                                        
                                                                              
                                                                                        
                                                                              
                                                                                        
                                                                              
                                                                                        
                                                                              
                                                                                        
                                                                              
                                                                            </ul>                
                                                                             
                                                                          </li>
                                                                      

                                                                        
                                                                        
                                                                        
                                                                        <li><a href="/spartacus-docs/4.x/configuring-base-url/">Configuring the Base URL</a>

                                                                          
                                                                            <ul>
                                                                              
                                                                            </ul>                
                                                                             
                                                                          </li>
                                                                      

                                                                        
                                                                        
                                                                        
                                                                        <li><a href="/spartacus-docs/4.x/type-augmentation/">Extending Built-In Models</a>

                                                                          
                                                                            <ul>
                                                                              
                                                                            </ul>                
                                                                             
                                                                          </li>
                                                                      

                                                                        
                                                                        
                                                                        
                                                                        <li><a href="/spartacus-docs/4.x/global-configuration-in-spartacus/">Global Configuration in Spartacus</a>

                                                                          
                                                                            <ul>
                                                                              
                                                                            </ul>                
                                                                             
                                                                          </li>
                                                                      

                                                                        
                                                                        
                                                                        
                                                                        <li><a href="/spartacus-docs/4.x/global-messages/">Global Messages</a>

                                                                          
                                                                            <ul>
                                                                              
                                                                            </ul>                
                                                                             
                                                                          </li>
                                                                      

                                                                        
                                                                        
                                                                        
                                                                        <li><a href="/spartacus-docs/4.x/http-error-handling/">HTTP Error Handling</a>

                                                                          
                                                                            <ul>
                                                                              
                                                                            </ul>                
                                                                             
                                                                          </li>
                                                                      

                                                                        
                                                                        
                                                                        
                                                                        <li><a href="/spartacus-docs/4.x/commands-and-queries/">Commands and Queries</a>

                                                                          
                                                                            <ul>
                                                                              
                                                                            </ul>                
                                                                             
                                                                          </li>
                                                                      

                                                                        
                                                                        
                                                                        
                                                                        <li><a href="/spartacus-docs/4.x/lazy-loading-guide/">Lazy Loading</a>

                                                                          
                                                                            <ul>
                                                                              
                                                                            </ul>                
                                                                             
                                                                          </li>
                                                                      

                                                                        
                                                                        
                                                                        
                                                                        <li><a href="/spartacus-docs/4.x/proxy-facades/">Proxy Facades</a>

                                                                          
                                                                            <ul>
                                                                              
                                                                            </ul>                
                                                                             
                                                                          </li>
                                                                      

                                                                        
                                                                        
                                                                        
                                                                        <li><a href="/spartacus-docs/4.x/context-configuration/">Multi-Site Configuration ➢</a>

                                                                          
                                                                            <ul>
                                                                              
                                                                                        
                                                                              
                                                                                        
                                                                              
                                                                            </ul>                
                                                                             
                                                                          </li>
                                                                      

                                                                        
                                                                        
                                                                        
                                                                        <li><a href="/spartacus-docs/4.x/pwa-home/">PWA ➢</a>

                                                                          
                                                                            <ul>
                                                                              
                                                                                        
                                                                              
                                                                                        
                                                                              
                                                                            </ul>                
                                                                             
                                                                          </li>
                                                                      

                                                                        
                                                                        
                                                                        
                                                                        <li><a href="/spartacus-docs/4.x/seo/">SEO ➢</a>

                                                                          
                                                                            <ul>
                                                                              
                                                                                        
                                                                              
                                                                                        
                                                                              
                                                                                        
                                                                              
                                                                            </ul>                
                                                                             
                                                                          </li>
                                                                      

                                                                        
                                                                        
                                                                        
                                                                        <li><a href="/spartacus-docs/4.x/session-management/">Session Management</a>

                                                                          
                                                                            <ul>
                                                                              
                                                                            </ul>                
                                                                             
                                                                          </li>
                                                                      

                                                                        
                                                                        
                                                                        
                                                                        <li><a href="/spartacus-docs/4.x/state-management/">State Management ➢</a>

                                                                          
                                                                            <ul>
                                                                              
                                                                                        
                                                                              
                                                                                
                                                                                  

                                                                                    
                                                                                    
                                                                                  
                                                                                    
                                                                                    
                                                                                         
                                                                                       <li><a href="/spartacus-docs/4.x/loader-meta-reducer/" class="">Loader Meta Reducer</a></li>

                                                                                  

                                                                                    
                                                                                    
                                                                                  
                                                                                    
                                                                                    
                                                                                         
                                                                                       <li><a href="/spartacus-docs/4.x/state-persistence/" class="active">State Persistence</a></li>

                                                                                  

                                                                                    
                                                                                    
                                                                                  
                                                                                    
                                                                                    
                                                                                         
                                                                                       <li><a href="/spartacus-docs/4.x/ssr-transfer-state/" class="">SSR Transfer State</a></li>

                                                                                       
                                                                                        
                                                                              
                                                                                        
                                                                              
                                                                            </ul>                
                                                                             
                                                                          </li>
                                                                      
                                                                      
                                                                  
                                                                      
                                                                  
                                                                
                                                            </ul>
                                                    </li>
                                                    
                                                

                                                
                                                

                                                  

                                                    <li><a href="/spartacus-docs/4.x/customizing-and-extending/">Customizing and Extending Spartacus ➢</a>
                                                  
                                                            <ul>
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                      
                                                                  
                                                                      
                                                                  
                                                                      
                                                                  
                                                                      
                                                                  
                                                                      
                                                                  
                                                                      
                                                                  
                                                                      
                                                                  
                                                                
                                                            </ul>
                                                    </li>
                                                    
                                                

                                                
                                                

                                                  

                                                    <li><a href="/spartacus-docs/4.x/customizing-backend-communication/">Customizing Back End Communication ➢</a>
                                                  
                                                            <ul>
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                            </ul>
                                                    </li>
                                                    
                                                

                                                
                                                

                                                  

                                                    <li><a href="/spartacus-docs/4.x/performance/">Performance Optimizations ➢</a>
                                                  
                                                            <ul>
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                            </ul>
                                                    </li>
                                                    
                                                

                                                
                                                

                                                  

                                                    <li><a href="/spartacus-docs/4.x/security-best-practices/">Security Best Practices ➢</a>
                                                  
                                                            <ul>
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                            </ul>
                                                    </li>
                                                    
                                                

                                                
                                                

                                                  

                                                    <li><a href="/spartacus-docs/4.x/server-side-rendering-in-spartacus/">Server-Side Rendering ➢</a>
                                                  
                                                            <ul>
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                            </ul>
                                                    </li>
                                                    
                                                

                                                
                                                

                                                  

                                                    <li><a href="/spartacus-docs/4.x/spartacus-features/">Storefront Features ➢</a>
                                                  
                                                            <ul>
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                      
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                            </ul>
                                                    </li>
                                                    
                                                

                                                
                                                

                                                  

                                                    <li><a href="/spartacus-docs/4.x/styling-and-page-layout/">Styling and Page Layout ➢</a>
                                                  
                                                            <ul>
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                            </ul>
                                                    </li>
                                                    
                                                
                                        
                                    
                                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
            </ul>  
      </li>          
    
      <li>
        
          
          

         <a href="/spartacus-docs/4.x/using-spartacus/"><span class="nav__sub-title">Using the Spartacus Storefront</span></a>
         
        
            <ul>
                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
            </ul>  
      </li>          
    
      <li>
        
          
          

         <a href="/spartacus-docs/4.x/about-tua-spartacus/"><span class="nav__sub-title">Telco & Utilities Storefront Development Guide</span></a>
         
        
            <ul>
                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
            </ul>  
      </li>          
    
      <li>
        
          
          

         <a href="/spartacus-docs/4.x/about-fsa-spartacus/"><span class="nav__sub-title">Financial Services Accelerator Storefront Development Guide</span></a>
         
        
            <ul>
                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
            </ul>  
      </li>          
    
      <li>
        
          
          

         <a href="/spartacus-docs/4.x/contributors-guide/"><span class="nav__sub-title">Contributing to Spartacus</span></a>
         
        
            <ul>
                
                        <ul>
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
            </ul>  
      </li>          
    
  </ul>
</nav>      

    
  
  </div>


  <div class="archive">
    
      <h1 id="page-title" class="page__title">State Persistence</h1>
    
    
<p><b>Note: </b> 
This feature is introduced with version 2.0 of the Spartacus libraries.
 </p>

<p>Prior to Spartacus version 2.0, the only way to achieve state persistence was by using a simple, declarative mechanism called <code class="language-plaintext highlighter-rouge">storageSync</code>, which allowed you to provide properties keys to persist in the store. When you started your application, these persisted keys were used to set the initial state in the store. With Spartacus version 2.0 or newer, you can persist the state of your storefront application by using the <code class="language-plaintext highlighter-rouge">StatePersistenceService</code>, and specifically, its <code class="language-plaintext highlighter-rouge">syncWithStorage</code> method. It is not as simple as <code class="language-plaintext highlighter-rouge">storageSync</code>, but it provides a lot more control using context and dedicated <code class="language-plaintext highlighter-rouge">onRead</code> callback.</p>

<p>You can pass the following options to the <code class="language-plaintext highlighter-rouge">syncWithStorage</code> function: <code class="language-plaintext highlighter-rouge">key</code>, <code class="language-plaintext highlighter-rouge">state$</code>, <code class="language-plaintext highlighter-rouge">context$</code>, <code class="language-plaintext highlighter-rouge">storageType</code>, and <code class="language-plaintext highlighter-rouge">onRead</code>.</p>

<p>These options work as follows:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">key</code> is used to distinguish one feature from another in storage. For example, to store the active cart id, you can use the <code class="language-plaintext highlighter-rouge">cart</code> key, and for the user session data, you can use the <code class="language-plaintext highlighter-rouge">session</code> key.</li>
  <li><code class="language-plaintext highlighter-rouge">state$</code> is an observable that emits a value every time you want to save the new value to the persistent storage. For example, to persist the active cart id every time the active cart id changes, this observable emits a new value.</li>
  <li><code class="language-plaintext highlighter-rouge">context$</code> is an observable that describes a valid context for a particular state. For example, the active cart id is valid only for one base site. On different base sites, you want to use different carts. In this case, with <code class="language-plaintext highlighter-rouge">context$</code>, you would use an observable that emits the base site every time it changes.</li>
  <li><code class="language-plaintext highlighter-rouge">storageType</code> specifies the storage type that is used. By default, the storage type is local storage, but you can change this to session storage, for example.</li>
  <li><code class="language-plaintext highlighter-rouge">onRead</code> is a callback that is invoked every time the context changes. To use the cart as an example, every time you change the base site, this callback is called with a value read from storage for that particular context. It will dispatch a value of <code class="language-plaintext highlighter-rouge">undefined</code> if there is nothing saved in storage.</li>
</ul>

<hr />

<p><strong>Table of Contents</strong></p>

<ul id="markdown-toc">
  <li><a href="#implementing-complete-state-persistence-for-a-feature" id="markdown-toc-implementing-complete-state-persistence-for-a-feature">Implementing Complete State Persistence for a Feature</a></li>
  <li><a href="#state-synchronization-in-action" id="markdown-toc-state-synchronization-in-action">State Synchronization in Action</a></li>
</ul>

<hr />

<h2 id="implementing-complete-state-persistence-for-a-feature">Implementing Complete State Persistence for a Feature</h2>

<p>The following steps describe how to implement state persistence for a feature, using the cart as an example:</p>

<ol>
  <li>
    <p>Create a service for cart state persistence.</p>

    <p>The following is an example:</p>

    <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c1">// Import dependencies.</span>

 <span class="p">@</span><span class="nd">Injectable</span><span class="p">({</span>
   <span class="na">providedIn</span><span class="p">:</span> <span class="dl">'</span><span class="s1">root</span><span class="dl">'</span><span class="p">,</span>
 <span class="p">})</span>
 <span class="k">export</span> <span class="kd">class</span> <span class="nx">MultiCartStatePersistenceService</span> <span class="p">{</span>
   <span class="kd">constructor</span><span class="p">(</span>
     <span class="k">protected</span> <span class="nx">statePersistenceService</span><span class="p">:</span> <span class="nx">StatePersistenceService</span><span class="p">,</span>
     <span class="k">protected</span> <span class="nx">store</span><span class="p">:</span> <span class="nx">Store</span><span class="o">&lt;</span><span class="nx">StateWithMultiCart</span><span class="o">&gt;</span><span class="p">,</span>
     <span class="k">protected</span> <span class="nx">siteContextParamsService</span><span class="p">:</span> <span class="nx">SiteContextParamsService</span>
   <span class="p">)</span> <span class="p">{}</span>

   <span class="k">public</span> <span class="nx">sync</span><span class="p">()</span> <span class="p">{</span>
     <span class="k">this</span><span class="p">.</span><span class="nx">statePersistenceService</span><span class="p">.</span><span class="nx">syncWithStorage</span><span class="p">({</span>
       <span class="c1">// We use this key to distinguish from other features.</span>
       <span class="na">key</span><span class="p">:</span> <span class="dl">'</span><span class="s1">cart</span><span class="dl">'</span><span class="p">,</span>
       <span class="nx">state</span><span class="na">$</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">getCartState</span><span class="p">(),</span>
       <span class="c1">// The cart is only valid on one base site, so we use the base site as a context value.</span>
       <span class="c1">// For common cases (language/currency/base site) `SiteContextParamsService.getValues` might be useful.</span>
       <span class="c1">// If the persisted value does not depend on any context, you can skip the `context$` parameter.</span>
       <span class="c1">// For more custom solutions, you might use anything here.</span>
       <span class="nx">context</span><span class="na">$</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">siteContextParamsService</span><span class="p">.</span><span class="nx">getValues</span><span class="p">([</span><span class="nx">BASE_SITE_CONTEXT_ID</span><span class="p">]),</span>
       <span class="c1">// We point to our read callback, that will be called with the value restored from persisted storage.</span>
       <span class="c1">// We will restore the value on every context change. If `context$` was not given, the `onRead` callback will be invoked only once, on application start.</span>
       <span class="na">onRead</span><span class="p">:</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">onRead</span><span class="p">(</span><span class="nx">state</span><span class="p">),</span>
     <span class="p">});</span>
   <span class="p">}</span>

   <span class="c1">// Every time the active cart changes, we emit a new value here to trigger a save to storage.</span>
   <span class="k">protected</span> <span class="nx">getCartState</span><span class="p">():</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="p">{</span> <span class="na">active</span><span class="p">:</span> <span class="kr">string</span> <span class="p">}</span><span class="o">&gt;</span> <span class="p">{</span>
     <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
       <span class="nx">select</span><span class="p">(</span><span class="nx">MultiCartSelectors</span><span class="p">.</span><span class="nx">getMultiCartState</span><span class="p">),</span>
       <span class="nx">filter</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="o">!!</span><span class="nx">state</span><span class="p">),</span>
       <span class="c1">// As an optimization, we try to emit only when necessary.</span>
       <span class="nx">distinctUntilKeyChanged</span><span class="p">(</span><span class="dl">'</span><span class="s1">active</span><span class="dl">'</span><span class="p">),</span>
       <span class="nx">map</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
         <span class="k">return</span> <span class="p">{</span>
           <span class="na">active</span><span class="p">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">active</span><span class="p">,</span>
         <span class="p">};</span>
       <span class="p">})</span>
     <span class="p">);</span>
   <span class="p">}</span>

   <span class="k">protected</span> <span class="nx">onRead</span><span class="p">(</span><span class="nx">state</span><span class="p">:</span> <span class="p">{</span> <span class="nl">active</span><span class="p">:</span> <span class="kr">string</span> <span class="p">})</span> <span class="p">{</span>
     <span class="c1">// We always want to clear the cart state when we enter the base site.</span>
     <span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="k">new</span> <span class="nx">CartActions</span><span class="p">.</span><span class="nx">ClearCartState</span><span class="p">());</span>
     <span class="c1">// The state might be undefined, when there isn't any data in storage.</span>
     <span class="c1">// When the state is defined, its type will be the same as the inner type of the `state$` observable.</span>
     <span class="k">if</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
       <span class="c1">// If we get the state, we want to point to the read active cart id.</span>
       <span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="k">new</span> <span class="nx">CartActions</span><span class="p">.</span><span class="nx">SetActiveCartId</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">active</span><span class="p">));</span>
     <span class="p">}</span>
   <span class="p">}</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Provide the created service when the application is initialized.</p>

    <p>The following is an example:</p>

    <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c1">// Import dependencies.</span>

 <span class="c1">// Create factory to invoke `sync` method.</span>
 <span class="k">export</span> <span class="kd">function</span> <span class="nx">cartStatePersistenceFactory</span><span class="p">(</span>
   <span class="nx">cartStatePersistenceService</span><span class="p">:</span> <span class="nx">MultiCartStatePersistenceService</span><span class="p">,</span>
   <span class="nx">configInit</span><span class="p">:</span> <span class="nx">ConfigInitializerService</span>
 <span class="p">)</span> <span class="p">{</span>
   <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span>
     <span class="c1">// With async configuration we want to wait for stable configuration.</span>
     <span class="c1">// We have a dependency on the base site that is part of the context config.</span>
     <span class="nx">configInit</span><span class="p">.</span><span class="nx">getStableConfig</span><span class="p">(</span><span class="dl">'</span><span class="s1">context</span><span class="dl">'</span><span class="p">).</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
       <span class="c1">// Initialize state persistence mechanism.</span>
       <span class="nx">cartStatePersistenceService</span><span class="p">.</span><span class="nx">sync</span><span class="p">();</span>
     <span class="p">});</span>
   <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
 <span class="p">}</span>

 <span class="c1">// It is recommended to couple state persistence with its main feature module.</span>
 <span class="p">@</span><span class="nd">NgModule</span><span class="p">({</span>
   <span class="na">imports</span><span class="p">:</span> <span class="p">[</span><span class="nx">MultiCartStoreModule</span><span class="p">,</span> <span class="nx">CartEventModule</span><span class="p">],</span>
 <span class="p">})</span>
 <span class="k">export</span> <span class="kd">class</span> <span class="nx">CartModule</span> <span class="p">{</span>
   <span class="k">static</span> <span class="nx">forRoot</span><span class="p">():</span> <span class="nx">ModuleWithProviders</span><span class="o">&lt;</span><span class="nx">CartModule</span><span class="o">&gt;</span> <span class="p">{</span>
     <span class="k">return</span> <span class="p">{</span>
       <span class="na">ngModule</span><span class="p">:</span> <span class="nx">CartModule</span><span class="p">,</span>
       <span class="na">providers</span><span class="p">:</span> <span class="p">[</span>
         <span class="c1">// Other providers here.</span>
         <span class="p">{</span>
           <span class="c1">// Run factory on APP_INITIALIZER</span>
           <span class="na">provide</span><span class="p">:</span> <span class="nx">APP_INITIALIZER</span><span class="p">,</span>
           <span class="na">useFactory</span><span class="p">:</span> <span class="nx">cartStatePersistenceFactory</span><span class="p">,</span>
           <span class="na">deps</span><span class="p">:</span> <span class="p">[</span><span class="nx">MultiCartStatePersistenceService</span><span class="p">,</span> <span class="nx">ConfigInitializerService</span><span class="p">],</span>
           <span class="na">multi</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
         <span class="p">},</span>
       <span class="p">],</span>
     <span class="p">};</span>
   <span class="p">}</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="state-synchronization-in-action">State Synchronization in Action</h2>

<p>The following is an example description of state synchronization with an electronics and an apparel storefront. In this example, the state persistence service is set up as follows:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">key</code>: <code class="language-plaintext highlighter-rouge">"cart"</code></li>
  <li><code class="language-plaintext highlighter-rouge">state$</code> : points to the active cart id selector</li>
  <li><code class="language-plaintext highlighter-rouge">context$</code>: <code class="language-plaintext highlighter-rouge">this.siteContextParamsService.getValues([BASE_SITE_CONTEXT_ID])</code> // The cart is valid only on the same base site</li>
  <li><code class="language-plaintext highlighter-rouge">onRead</code>: function dispatches <code class="language-plaintext highlighter-rouge">ClearCart</code> action, and then <code class="language-plaintext highlighter-rouge">SetActiveCartId</code> when the id is read from storage</li>
</ul>

<p>The following describes an example flow of the state synchronization:</p>

<ol>
  <li>
    <p>Access the <code class="language-plaintext highlighter-rouge">electronics</code> base site for the first time.</p>

    <p>The <code class="language-plaintext highlighter-rouge">onRead</code> callback is invoked with <code class="language-plaintext highlighter-rouge">undefined</code>, because there was nothing under the <code class="language-plaintext highlighter-rouge">spartacus⚿electronics⚿cart</code> key in local storage. In this implementation of <code class="language-plaintext highlighter-rouge">onRead</code>, the cart state is cleared by dispatching the <code class="language-plaintext highlighter-rouge">ClearCart</code> action.</p>
  </li>
  <li>
    <p>Add something to the cart.</p>

    <p>In the background, the cart is created, and the active cart id selector emits a new value. Now the active cart id is saved under the <code class="language-plaintext highlighter-rouge">spartacus⚿electronics⚿cart</code> key in local storage.</p>
  </li>
  <li>
    <p>Switch from the <code class="language-plaintext highlighter-rouge">electronics</code> to the <code class="language-plaintext highlighter-rouge">apparel</code> site, where there are a few items already added to the cart.</p>

    <p>The <code class="language-plaintext highlighter-rouge">onRead</code> callback is invoked with the active cart id for this site, which is read from the <code class="language-plaintext highlighter-rouge">spartacus⚿apparel⚿cart</code> key in storage. In this example implementation, the <code class="language-plaintext highlighter-rouge">onRead</code> clears the state and sets the active cart id. Then, <code class="language-plaintext highlighter-rouge">ActiveCartService</code> selects this id and loads the cart that was created in a previous session.</p>
  </li>
  <li>
    <p>Return to the <code class="language-plaintext highlighter-rouge">electronics</code> site.</p>

    <p>The same steps repeat. The <code class="language-plaintext highlighter-rouge">onRead</code> is invoked with the cart id from the <code class="language-plaintext highlighter-rouge">electronics</code> site, the <code class="language-plaintext highlighter-rouge">apparel</code> ngrx state is cleared, and the correct cart is loaded.</p>
  </li>
</ol>


<!-- <h3 class="archive__subtitle">Recent posts</h3>




 -->

  </div>
</div>
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><div class="docsearch-container"><input type="search" id="docsearch" aria-placeholder="Enter your search term..." class="search-input" tabindex="-1" placeholder="Enter your search term..." /></div>
    <!-- <div id="results" class="results"></div> --></div>

      </div>
    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->
<table BORDER="0"><tr><td class="tdfooter"><a href="https://www.sap.com/copyright" target="_blank">Copyright</a></td>

<td class="tdfooter"><a href="https://sap.github.io/spartacus-docs/privacy-statement/">Privacy Statement</a></td>

<td class="tdfooter"><a href="https://www.sap.com/impressum" target="_blank">Legal Disclosure</a></td>

<td class="tdfooter"><a href="https://www.sap.com/trademark" target="_blank">Trademark</a></td>

<td class="tdfooter"><a href="https://www.sap.com/terms-of-use" target="_blank">Terms of Use</a></td></tr></table>
<!-- end custom footer snippets -->
        <!-- <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    <li><a href="/spartacus-docs/4.x/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 Spartacus Documentation. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div> -->

      </footer>
    </div>

    
  <script src="/spartacus-docs/4.x/assets/js/main.min.js"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.8.2/js/all.js" integrity="sha384-DJ25uNYET2XCl5ZF++U8eNxPWqcKohUUBUpKGlNLMchM7q4Wjg2CUpjHLaL8yYPH" crossorigin="anonymous"></script>










    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script> 
    <script type="text/javascript"> docsearch({ 
    apiKey: 'b6583768751462c6ee53d5a5720cda44', 
    indexName: 'sap_spartacus', 
    inputSelector: '#docsearch', 
    algoliaOptions: {
      'facetFilters': ["tags:4.x"]
      },
    debug: false // Set debug to true if you want to inspect the dropdown 
    }); 
    </script> 

    <script>
      anchors.options = {
      visible: 'hover',
      icon: "\uf0c1"
      };
    anchors.add();
    </script>

    </body>
</html>
