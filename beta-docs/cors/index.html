<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.4 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Cross-Origin Resource Sharing (CORS) - Spartacus Documentation</title>
<meta name="description" content="SAP Spartacus JavaScript Storefront Documentation.">



<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Spartacus Documentation">
<meta property="og:title" content="Cross-Origin Resource Sharing (CORS)">
<meta property="og:url" content="/spartacus-docs/beta-docs/cors/">












  

  


<link rel="canonical" href="/spartacus-docs/beta-docs/cors/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": null,
      "url": null,
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/spartacus-docs/beta-docs/feed.xml" type="application/atom+xml" rel="alternate" title="Spartacus Documentation Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/spartacus-docs/beta-docs/assets/css/main.css">
<link rel="stylesheet" href="/spartacus-docs/beta-docs/assets/css/keys.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert scripts for adding anchor links to headers -->

<script src="https://kit.fontawesome.com/82d5a2bf2f.js" crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js"></script>
<script>
  anchors.add();
</script>

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" /> 
  </head>

  <body class="layout--home">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/spartacus-docs/beta-docs/"><img src="/spartacus-docs/beta-docs/assets/images/logo-blue_64x64.png" alt="Spartacus logo"></a>
        
        <a class="site-title" href="/spartacus-docs/beta-docs/">Spartacus Documentation</a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/spartacus-docs/beta-docs/docs-archive/" >Doc Archive</a>
            </li><li class="masthead__menu-item">
              <a href="https://join.slack.com/t/spartacus-storefront/shared_invite/zt-jekftqo0-HP6xt6IF~ffVB2cGG66fcQ" >Feedback</a>
            </li><li class="masthead__menu-item">
              <a href="/spartacus-docs/beta-docs/#how-to-obtain-support" >Support</a>
            </li><li class="masthead__menu-item">
              <a href="/spartacus-docs/beta-docs/release-information/" >Version 5.0</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle menu</label>
  <ul class="nav__items">
    
      <li>
        
          
          

         <a href="/spartacus-docs/beta-docs/"><span class="nav__sub-title">Home</span></a>
         
        
            <ul>
                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
            </ul>  
      </li>          
    
      <li>
        
          
          

         <a href="/spartacus-docs/beta-docs/getting-started/"><span class="nav__sub-title">Getting Started with Spartacus Libraries</span></a>
         
        
            <ul>
                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    
                        

                          
                          

                            
                            

                            <li><a href="/spartacus-docs/beta-docs/installing-sap-commerce-cloud/" class="">Installing SAP Commerce Cloud for use with Spartacus ➢</a>
                                
                                    <ul>
                                        

                                          
                                          

                                              
                                        

                                          
                                          

                                              
                                        

                                          
                                          

                                              
                                        

                                          
                                          

                                              
                                        
                                    </ul>
                                
                            </li>     
                        

                          
                          

                            
                            

                            <li><a href="/spartacus-docs/beta-docs/cors/" class="active">Cross-Origin Resource Sharing (CORS)</a>
                                
                            </li>     
                        

                          
                          

                            
                            

                            <li><a href="/spartacus-docs/beta-docs/reference-app-structure/" class="">Reference App Structure</a>
                                
                            </li>     
                        

                          
                          

                            
                            

                            <li><a href="/spartacus-docs/beta-docs/building-the-spartacus-storefront-from-libraries/" class="">Building the Spartacus Storefront from Libraries ➢</a>
                                
                                    <ul>
                                        

                                          
                                          

                                              
                                        

                                          
                                          

                                              
                                        

                                          
                                          

                                              
                                        

                                          
                                          

                                              
                                        
                                    </ul>
                                
                            </li>     
                        

                          
                          

                            
                            

                            <li><a href="/spartacus-docs/beta-docs/recommended-development-environment/" class="">Recommended Development Environment</a>
                                
                            </li>     
                        

                          
                          

                            
                            

                            <li><a href="/spartacus-docs/beta-docs/browser-support/" class="">Web Browser Support</a>
                                
                            </li>     
                        

                          
                          

                            
                            

                            <li><a href="/spartacus-docs/beta-docs/integrations/" class="">Integrations ➢</a>
                                
                                    <ul>
                                        

                                          
                                          

                                              
                                        

                                          
                                          

                                              
                                        

                                          
                                          

                                              
                                        

                                          
                                          

                                              
                                        

                                          
                                          

                                              
                                        

                                          
                                          

                                              
                                        

                                          
                                          

                                              
                                        

                                          
                                          

                                              
                                        

                                          
                                          

                                              
                                        

                                          
                                          

                                              
                                        

                                          
                                          

                                              
                                        
                                    </ul>
                                
                            </li>     
                        
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
            </ul>  
      </li>          
    
      <li>
        
          
          

         <a href="/spartacus-docs/beta-docs/dev-guide/"><span class="nav__sub-title">Storefront Development Guide</span></a>
         
        
            <ul>
                
                        <ul>
                            
                                    

                                  
                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
            </ul>  
      </li>          
    
      <li>
        
          
          

         <a href="/spartacus-docs/beta-docs/using-spartacus/"><span class="nav__sub-title">Using the Spartacus Storefront</span></a>
         
        
            <ul>
                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
            </ul>  
      </li>          
    
      <li>
        
          
          

         <a href="/spartacus-docs/beta-docs/about-tua-spartacus/"><span class="nav__sub-title">Telco & Utilities Storefront Development Guide</span></a>
         
        
            <ul>
                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
            </ul>  
      </li>          
    
      <li>
        
          
          

         <a href="/spartacus-docs/beta-docs/about-fsa-spartacus/"><span class="nav__sub-title">Financial Services Accelerator Storefront Development Guide</span></a>
         
        
            <ul>
                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
            </ul>  
      </li>          
    
      <li>
        
          
          

         <a href="/spartacus-docs/beta-docs/contributors-guide/"><span class="nav__sub-title">Contributing to Spartacus</span></a>
         
        
            <ul>
                
                        <ul>
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
            </ul>  
      </li>          
    
  </ul>
</nav>      

    
  
  </div>


  <div class="archive">
    
      <h1 id="page-title" class="page__title">Cross-Origin Resource Sharing (CORS)</h1>
    
    <p>CORS is a standard mechanism on the web that enables cross-domain requests from web applications to reach servers on different domains. Cross-origin requests could also be thought of as “cross-domain requests”. Browsers block cross-origin requests whenever the required HTTP headers are not available in the response.</p>

<p>The response headers are dictated by the server, which is why the server must be set up to generate the correct headers. In the SAP Commerce Cloud back end, these headers can be <a href="https://help.sap.com/viewer/d0224eca81e249cb821f2cdf45a82ace/latest/en-US/b27d995150a74be08869e60e3fbc7395.html?q=authorization%20CORS">configured in a generic fashion</a> by using a CorsFilter. Project properties can be used to configure this for each node, or an ImpEx installation script can be used to install to each node.</p>

<hr />

<p><strong>Table of Contents</strong></p>

<ul id="markdown-toc">
  <li><a href="#cors-headers" id="markdown-toc-cors-headers">CORS Headers</a>    <ul>
      <li><a href="#allowedorigins" id="markdown-toc-allowedorigins">allowedOrigins</a></li>
      <li><a href="#allowedmethods" id="markdown-toc-allowedmethods">allowedMethods</a></li>
      <li><a href="#allowedheaders" id="markdown-toc-allowedheaders">allowedHeaders</a></li>
      <li><a href="#exposedheaders" id="markdown-toc-exposedheaders">exposedHeaders</a></li>
      <li><a href="#allowcredentials" id="markdown-toc-allowcredentials">allowCredentials</a></li>
    </ul>
  </li>
  <li><a href="#setting-up-cors" id="markdown-toc-setting-up-cors">Setting Up CORS</a>    <ul>
      <li><a href="#project-properties-file" id="markdown-toc-project-properties-file">Project Properties File</a></li>
      <li><a href="#commerce-cloud-manifest-configuration" id="markdown-toc-commerce-cloud-manifest-configuration">Commerce Cloud Manifest Configuration</a></li>
      <li><a href="#impex" id="markdown-toc-impex">Impex</a></li>
    </ul>
  </li>
  <li><a href="#troubleshooting" id="markdown-toc-troubleshooting">Troubleshooting</a>    <ul>
      <li><a href="#determining-if-a-problem-is-caused-by-a-cors-issue" id="markdown-toc-determining-if-a-problem-is-caused-by-a-cors-issue">Determining If a Problem Is Caused by a CORS Issue</a></li>
      <li><a href="#determining-the-cause-of-a-cors-error" id="markdown-toc-determining-the-cause-of-a-cors-error">Determining the Cause of a CORS Error</a></li>
      <li><a href="#resolving-the-cors-error" id="markdown-toc-resolving-the-cors-error">Resolving the CORS Error</a></li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="cors-headers">CORS Headers</h2>

<p>You can use various CORS headers to specify whether the origin is allowed, with or without certain methods, headers, cookies, and so on. The following sections describe each of the configurations as they are related to Spartacus.</p>

<h3 id="allowedorigins">allowedOrigins</h3>

<p>In development, the allowed origins are often configured with an asterisk (<code class="language-plaintext highlighter-rouge">*</code>), which allowlists all clients, regardless of their domain. In a production environment, this should contain the different domains that are allowed to interact with the back end API.</p>

<h3 id="allowedmethods">allowedMethods</h3>

<p>The allowed headers must include all the HTTP methods that are allowed to be used. For Spartacus, the following methods should be configured:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET HEAD OPTIONS PATCH PUT POST DELETE
</code></pre></div></div>

<p>If you use custom methods in your project, you should add these methods to this list.</p>

<h3 id="allowedheaders">allowedHeaders</h3>

<p>The allowed headers setting indicates the HTTP headers that are allowed for cross-origin requests. If these header are not allowed cross-origin, Spartacus will not get a response for a specific request. Most of the headers are standard headers, but there are a few headers that you might need that are feature specific. The following list provides an overview of all the headers that can be used.</p>

<table>
  <thead>
    <tr>
      <th>Header</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>origin</td>
      <td>The <code class="language-plaintext highlighter-rouge">origin</code> request header indicates where a request originates from. This is sent by the browser with each cross-origin request, and must therefore be configured for all requests.</td>
    </tr>
    <tr>
      <td>content-type</td>
      <td>The <code class="language-plaintext highlighter-rouge">content-type</code> header is used to indicate the media type of the resource. It is not required for all APIs, but it is often used nonetheless.</td>
    </tr>
    <tr>
      <td>accept</td>
      <td>The <code class="language-plaintext highlighter-rouge">accept</code> request header indicates the formats that can be read by the browser. It is sent pn a few occasions in Spartacus.</td>
    </tr>
    <tr>
      <td>authorization</td>
      <td>The <code class="language-plaintext highlighter-rouge">authorization</code> request header is used during authentication. Unless there is no login process, this must be configured.</td>
    </tr>
    <tr>
      <td>cache-control</td>
      <td>The <code class="language-plaintext highlighter-rouge">cache-control</code> headers are used for various API requests.</td>
    </tr>
    <tr>
      <td>x-anonymous-consents</td>
      <td>The <code class="language-plaintext highlighter-rouge">x-anonymous-consents</code> header is required by the anonymous consent feature. If anonymous consent is not used, this configuration can be omitted. However, it is important to note that if you do not include this header, you must disable the anonymous consent feature. Otherwise, you might encounter problems with your storefront not displaying properly.</td>
    </tr>
    <tr>
      <td>occ-personalization-id</td>
      <td>The <code class="language-plaintext highlighter-rouge">occ-personalization-id</code> header is required by the personalization feature. If you do not use the personalization feature, this header can be omitted. For more information, see <a href="https://help.sap.com/viewer/9d346683b0084da2938be8a285c0c27a/latest/en-US/e970070f997041c7b3f3e77fcb762744.html">Configure Personalization for Commerce Web Services</a> on the SAP Help Portal.</td>
    </tr>
    <tr>
      <td>occ-personalization-time</td>
      <td>The <code class="language-plaintext highlighter-rouge">occ-personalization-time</code> header is required by the personalization feature. If you do not use the personalization feature, this header can be omitted. For more information, see <a href="https://help.sap.com/viewer/9d346683b0084da2938be8a285c0c27a/latest/en-US/e970070f997041c7b3f3e77fcb762744.html">Configure Personalization for Commerce Web Services</a> on the SAP Help Portal.</td>
    </tr>
    <tr>
      <td>x-profile-tag-debug</td>
      <td>The <code class="language-plaintext highlighter-rouge">x-profile-tag-debug</code> header is required by Intelligent Selling Services for SAP Commerce Cloud. It is used to instruct Intelligent Selling Services to produce a trace. If you do not use Intelligent Selling Services for SAP Commerce Cloud, this header can be omitted. For more information, see <a href="https://help.sap.com/viewer/product/CONTEXT-DRIVEN_SERVICES/SHIP/en-US?task=discover_task">Intelligent Selling Services for SAP Commerce Cloud</a> on the SAP Help Portal.</td>
    </tr>
    <tr>
      <td>x-consent-reference</td>
      <td>The <code class="language-plaintext highlighter-rouge">x-consent-reference</code> header is required by Intelligent Selling Services for SAP Commerce Cloud. If you do not use Intelligent Selling Services for SAP Commerce Cloud, this header can be omitted. For more information, see <a href="https://help.sap.com/viewer/product/CONTEXT-DRIVEN_SERVICES/SHIP/en-US?task=discover_task">Intelligent Selling Services for SAP Commerce Cloud</a> on the SAP Help Portal.</td>
    </tr>
  </tbody>
</table>

<h3 id="exposedheaders">exposedHeaders</h3>

<p>Intelligent Selling Services for SAP Commerce Cloud requires a custom header to be exposed, which is the <code class="language-plaintext highlighter-rouge">x-anonymous-consents</code> header.</p>

<p>Personalization requires the <code class="language-plaintext highlighter-rouge">occ-personalization-id</code> and the <code class="language-plaintext highlighter-rouge">occ-personalization-time</code> headers to be exposed.</p>

<h3 id="allowcredentials">allowCredentials</h3>

<p>Request credentials are concerned with cookies, authorization headers, or TLS client certificates. These are not allowed in cross-origin requests by default, which is why a request is blocked when the configuration is not applied.</p>

<p>Spartacus did not send cookies in version 1.x of the Spartacus libraries, but since version 2.0, cookies will be sent for each and every OCC request. This has also been patched to versions 1.4 and 1.5 of the Spartacus libraries.</p>

<p>Sending cookies is required to gain “session affinity”, which is also know as “sticky sessions”. Session affinity means that the same server behind an API endpoint is used for all subsequent requests for the same session. Although the Commerce API is stateless, there are occasions when multiple parallel or sequential calls could fail. For example, an “add to cart” request followed by a “load cart” request could fail, because the first request could end up at server 1, whereas the second request, immediately following after, could end up at server 2. The servers might not be fast enough to send around cache invalidation, which is why the second response might fail to catch the added item.</p>

<p>An added advantage of session affinity is that the back end will gain performance improvements if requests for the same session are served by the same server.</p>

<p>For this reason, CCv2 exposes a response cookie (<code class="language-plaintext highlighter-rouge">ROUTE</code>) that indicates the processing server that was used to process the API request. Whenever the client adds this cookie into the next request, the request is handled by the same server.</p>

<h2 id="setting-up-cors">Setting Up CORS</h2>

<p>The various CORS configurations that are required by the back end can be installed in the following ways:</p>

<ul>
  <li>using configuration properties to install them during a deployment</li>
  <li>using the Commerce Cloud manifest file to install them during a deployment</li>
  <li>using an ImpEx script to install them at runtime</li>
  <li>using Backoffice to configure them manually at runtime</li>
</ul>

<p>For each installation, it is important to note the following:</p>

<ul>
  <li>OCC is installed by a template extension with the name <code class="language-plaintext highlighter-rouge">commercewebservices</code>. However, you can rename the extension web application path, or generate a custom extension out of this. In the examples in the next sections, we assume the name is <code class="language-plaintext highlighter-rouge">commercewebservices</code>, but you should replace this if you have a custom name.</li>
  <li>Most configurations apply to OCC only, but in case you use other APIs (such as the Assisted Service Module), you also need to configure CORS for these APIs as well.</li>
</ul>

<p><strong>Note:</strong> If you are using SAP Commerce Cloud version 1905 or older, you must use <code class="language-plaintext highlighter-rouge">ycommercewebservices</code> (or your custom extension name) and not <code class="language-plaintext highlighter-rouge">commercewebservices</code>. If you are using SAP Commerce Cloud version 2005 or newer, you can choose to use <code class="language-plaintext highlighter-rouge">commercewebservices</code> or <code class="language-plaintext highlighter-rouge">ycommercewebservices</code>, but the default is <code class="language-plaintext highlighter-rouge">commercewebservices</code>, which is defined by the cx recipe.</p>

<h3 id="project-properties-file">Project Properties File</h3>

<p>If you install the CORS filter configuration by properties, the following properties must be added:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>corsfilter.commercewebservices.allowedOrigins=*
corsfilter.commercewebservices.allowedMethods=GET HEAD OPTIONS PATCH PUT POST DELETE
corsfilter.commercewebservices.allowedHeaders=origin content-type accept authorization cache-control x-anonymous-consents x-profile-tag-debug x-consent-reference occ-personalization-id occ-personalization-time
corsfilter.commercewebservices.exposedHeaders=x-anonymous-consents occ-personalization-id occ-personalization-time
corsfilter.commercewebservices.allowCredentials=true
</code></pre></div></div>

<p>If you are using the Assisted Service Module (ASM), you must also add the same headers to the <code class="language-plaintext highlighter-rouge">corsfilter.assistedservicewebservices</code> settings, as follows:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>corsfilter.assistedservicewebservices.allowedOrigins=*
corsfilter.assistedservicewebservices.allowedMethods=GET HEAD OPTIONS PATCH PUT POST DELETE
corsfilter.assistedservicewebservices.allowedHeaders=origin content-type accept authorization cache-control x-anonymous-consents x-profile-tag-debug x-consent-reference occ-personalization-id occ-personalization-time
corsfilter.assistedservicewebservices.exposedHeaders=x-anonymous-consents occ-personalization-id occ-personalization-time
corsfilter.assistedservicewebservices.allowCredentials=true
</code></pre></div></div>

<h3 id="commerce-cloud-manifest-configuration">Commerce Cloud Manifest Configuration</h3>

<p>If you install the CORS filter configuration using the Commerce Cloud manifest file, add the following headers to the manifest file:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
	</span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"corsfilter.commercewebservices.allowedOrigins"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
</span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="p">{</span><span class="w">
	</span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"corsfilter.commercewebservices.allowedMethods"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GET HEAD OPTIONS PATCH PUT POST DELETE"</span><span class="w">
</span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="p">{</span><span class="w">
	</span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"corsfilter.commercewebservices.allowedHeaders"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"origin content-type accept authorization cache-control x-anonymous-consents x-profile-tag-debug x-consent-reference occ-personalization-id occ-personalization-time"</span><span class="w">
</span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="p">{</span><span class="w">
	</span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"corsfilter.commercewebservices.exposedHeaders"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"x-anonymous-consents occ-personalization-id occ-personalization-time"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="w">
	</span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"corsfilter.commercewebservices.allowCredentials"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"true"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>If you use the Assisted Service Module (ASM), you must also add the same headers to the <code class="language-plaintext highlighter-rouge">corsfilter.assistedservicewebservices</code> settings, as follows:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
	</span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"corsfilter.assistedservicewebservices.allowedOrigins"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
</span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="p">{</span><span class="w">
	</span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"corsfilter.assistedservicewebservices.allowedMethods"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GET HEAD OPTIONS PATCH PUT POST DELETE"</span><span class="w">
</span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="p">{</span><span class="w">
	</span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"corsfilter.assistedservicewebservices.allowedHeaders"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"origin content-type accept authorization cache-control x-anonymous-consents x-profile-tag-debug x-consent-reference occ-personalization-id occ-personalization-time"</span><span class="w">
</span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="p">{</span><span class="w">
	</span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"corsfilter.assistedservicewebservices.exposedHeaders"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"x-anonymous-consents occ-personalization-id occ-personalization-time"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="w">
	</span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"corsfilter.assistedservicewebservices.allowCredentials"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"true"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="impex">Impex</h3>

<p>You can use the following ImpEx script if you want to install the CORS filter configuration during initialization, during an update, or manually with the Hybris Admin Console.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INSERT_UPDATE CorsConfigurationProperty;key[unique=true];value;context[default=commercewebservices,unique=true]
;allowedOrigins;*
;allowedMethods;GET HEAD OPTIONS PATCH PUT POST DELETE
;allowedHeaders;origin content-type accept authorization cache-control x-anonymous-consents x-profile-tag-debug x-consent-reference occ-personalization-id occ-personalization-time
;allowCredentials;true
;exposedHeaders;x-anonymous-consents occ-personalization-id occ-personalization-time
</code></pre></div></div>

<p>If you are using the Assisted Service Module (ASM), you must also run the following script:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INSERT_UPDATE CorsConfigurationProperty;key[unique=true];value;context[default=assistedservicewebservices,unique=true]
;allowedOrigins;*
;allowedMethods;GET HEAD OPTIONS PATCH PUT POST DELETE
;allowedHeaders;origin content-type accept authorization cache-control x-anonymous-consents x-profile-tag-debug x-consent-reference occ-personalization-id occ-personalization-time
;allowCredentials;true
;exposedHeaders;x-anonymous-consents occ-personalization-id occ-personalization-time
</code></pre></div></div>

<h2 id="troubleshooting">Troubleshooting</h2>

<p>When troubleshooting a possible CORS issue, the first step is to determine if a CORS error is the source of the problem. If it is, you can determine what is causing the CORS error, and then resolve it.</p>

<h3 id="determining-if-a-problem-is-caused-by-a-cors-issue">Determining If a Problem Is Caused by a CORS Issue</h3>

<p>To determine if a problem is caused by a CORS issue, you can open the <strong>Network</strong> tab in your browser’s development tools and try to reproduce the problem with the <strong>Network</strong> tab open. In the following example, there are two requests that are highlighted in red, and in the <strong>Status</strong> column, one of the requests is listed as having a <code class="language-plaintext highlighter-rouge">CORS error</code>:</p>

<p><img src="/spartacus-docs/beta-docs/assets/images/cors/cors-error-01.png" alt="Network tab: request with cors error" width="950" border="1px" /></p>

<h3 id="determining-the-cause-of-a-cors-error">Determining the Cause of a CORS Error</h3>

<p>To support CORS, your browser makes a preflight request to the server to verify that the server will allow the real request to go through. It is often the case that the CORS issue is the result of an error with the preflight request. The preflight request has the same URL as the real request, but the HTTP method is <code class="language-plaintext highlighter-rouge">OPTIONS</code>. Google Chrome offers a convenient <strong>Preflight</strong> link in the <strong>Method</strong> column of the <strong>Network</strong> tab. When you click on the <strong>Preflight</strong> link of a request, the associated preflight request is highlighted, as show in the following example:</p>

<p><img src="/spartacus-docs/beta-docs/assets/images/cors/cors-error-02.png" alt="Network tab: request with cors error" width="950" border="1px" /></p>

<p>When you select the preflight request, you can see detailed information about the headers. In the request header info, look for headers that start with <code class="language-plaintext highlighter-rouge">Access-Control-Request-*</code>, such as in the following example:</p>

<p><img src="/spartacus-docs/beta-docs/assets/images/cors/cors-error-03.png" alt="Network tab: request with cors error" width="950" border="1px" /></p>

<p>The error is often caused by the back end server not being configured to allow one of the elements that is listed in one of the <code class="language-plaintext highlighter-rouge">Access-Control-Request-*</code> headers.</p>

<h3 id="resolving-the-cors-error">Resolving the CORS Error</h3>

<p>If you see that a legitimate header or HTTP method is being used, you should be able to resolve the issue by adding the header or HTTP method to the server’s CORS configuration.</p>

<p>HTTP headers need to be added to at least one of the <code class="language-plaintext highlighter-rouge">corsfilter.*.allowedHeaders</code> properties (that is, the one related to the back end extension that serves the request.)</p>

<p>HTTP methods are allowed by adding them to the <code class="language-plaintext highlighter-rouge">corsfilter.*.allowedMethods</code>. Again, which property you need to add depends on which back end extension serves the request.</p>

<p>To resolve the error in the above examples, you add the <code class="language-plaintext highlighter-rouge">authorization</code> header in the <code class="language-plaintext highlighter-rouge">corsfilter.assistedservicewebservices.allowedHeaders</code> back end configuration property.</p>

<p>To know which extension serves which URL, you can use the following table of URLS and their corresponding extensions for an out-of-the-box Commerce Cloud deployment:</p>

<table>
  <thead>
    <tr>
      <th>Webservice URL</th>
      <th>Back End Extension Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>/authentication/*</td>
      <td>oauth2</td>
    </tr>
    <tr>
      <td>/occ/v2/*</td>
      <td>commercewebservices</td>
    </tr>
    <tr>
      <td>/assistedservicewebservices/*</td>
      <td>assistedservicewebservices</td>
    </tr>
  </tbody>
</table>

<p>For more information about preflight requests, see the <a href="https://developer.mozilla.org/en-US/docs/Glossary/Preflight_request">MDN Web Docs</a>.</p>


<!-- <h3 class="archive__subtitle">Recent posts</h3>




 -->

  </div>
</div>
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><div class="docsearch-container"><input type="search" id="docsearch" aria-placeholder="Enter your search term..." class="search-input" tabindex="-1" placeholder="Enter your search term..." /></div>
    <!-- <div id="results" class="results"></div> --></div>

      </div>
    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->
<table BORDER="0"><tr><td class="tdfooter"><a href="https://www.sap.com/copyright" target="_blank">Copyright</a></td>

<td class="tdfooter"><a href="https://sap.github.io/spartacus-docs/privacy-statement/">Privacy Statement</a></td>

<td class="tdfooter"><a href="https://www.sap.com/impressum" target="_blank">Legal Disclosure</a></td>

<td class="tdfooter"><a href="https://www.sap.com/trademark" target="_blank">Trademark</a></td>

<td class="tdfooter"><a href="https://www.sap.com/terms-of-use" target="_blank">Terms of Use</a></td></tr></table>
<!-- end custom footer snippets -->
        <!-- <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    <li><a href="/spartacus-docs/beta-docs/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 Spartacus Documentation. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div> -->

      </footer>
    </div>

    
  <script src="/spartacus-docs/beta-docs/assets/js/main.min.js"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.8.2/js/all.js" integrity="sha384-DJ25uNYET2XCl5ZF++U8eNxPWqcKohUUBUpKGlNLMchM7q4Wjg2CUpjHLaL8yYPH" crossorigin="anonymous"></script>










    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script> 
    <script type="text/javascript"> docsearch({ 
    appId: 'BNZEXRISC6',
    apiKey: '54a795a072ff713045038ee4ad33c990', 
    indexName: 'sap_spartacus', 
    inputSelector: '#docsearch', 
    algoliaOptions: {
      'facetFilters': ["tags:latest"]
      },
    debug: false // Set debug to true if you want to inspect the dropdown 
    }); 
    </script> 

    <script>
      anchors.options = {
      visible: 'hover',
      icon: "\uf0c1"
      };
    anchors.add();
    </script>

    </body>
</html>
