<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.4 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Checkout Libraries Release Notes - Spartacus Documentation</title>
<meta name="description" content="SAP Spartacus JavaScript Storefront Documentation.">



<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Spartacus Documentation">
<meta property="og:title" content="Checkout Libraries Release Notes">
<meta property="og:url" content="/spartacus-docs/beta-docs/checkout-libraries-release-notes/">












  

  


<link rel="canonical" href="/spartacus-docs/beta-docs/checkout-libraries-release-notes/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": null,
      "url": null,
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/spartacus-docs/beta-docs/feed.xml" type="application/atom+xml" rel="alternate" title="Spartacus Documentation Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/spartacus-docs/beta-docs/assets/css/main.css">
<link rel="stylesheet" href="/spartacus-docs/beta-docs/assets/css/keys.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert scripts for adding anchor links to headers -->

<script src="https://kit.fontawesome.com/82d5a2bf2f.js" crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js"></script>
<script>
  anchors.add();
</script>

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" /> 
  </head>

  <body class="layout--home">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/spartacus-docs/beta-docs/"><img src="/spartacus-docs/beta-docs/assets/images/logo-blue_64x64.png" alt="Spartacus logo"></a>
        
        <a class="site-title" href="/spartacus-docs/beta-docs/">Spartacus Documentation</a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/spartacus-docs/beta-docs/docs-archive/" >Doc Archive</a>
            </li><li class="masthead__menu-item">
              <a href="https://join.slack.com/t/spartacus-storefront/shared_invite/zt-jekftqo0-HP6xt6IF~ffVB2cGG66fcQ" >Feedback</a>
            </li><li class="masthead__menu-item">
              <a href="/spartacus-docs/beta-docs/#how-to-obtain-support" >Support</a>
            </li><li class="masthead__menu-item">
              <a href="/spartacus-docs/beta-docs/release-information/" >Version 5.0</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle menu</label>
  <ul class="nav__items">
    
      <li>
        
          
          

         <a href="/spartacus-docs/beta-docs/"><span class="nav__sub-title">Home</span></a>
         
        
            <ul>
                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                                

                                                
                                                

                                                  

                                                    <li><a href="/spartacus-docs/beta-docs/release-information/">Release Information ➢</a>
                                                  
                                                            <ul>
                                                                
                                                                  
                                                                
                                                                  
                                                                
                                                                  
                                                                    
                                                                      

                                                                        
                                                                        
                                                                        
                                                                        <li><a href="/spartacus-docs/beta-docs/pre-release-information/">Pre-Release Information</a>

                                                                          
                                                                            <ul>
                                                                              
                                                                            </ul>                
                                                                             
                                                                          </li>
                                                                      

                                                                        
                                                                        
                                                                        
                                                                        <li><a href="/spartacus-docs/beta-docs/feature-release-versions/">Feature Compatibility</a>

                                                                          
                                                                            <ul>
                                                                              
                                                                            </ul>                
                                                                             
                                                                          </li>
                                                                      

                                                                        
                                                                        
                                                                        
                                                                        <li><a href="/spartacus-docs/beta-docs/updating-to-version-5/">Updating to Version 5.0 ➢</a>

                                                                          
                                                                            <ul>
                                                                              
                                                                                
                                                                                  

                                                                                    
                                                                                    
                                                                                  
                                                                                    
                                                                                    
                                                                                         
                                                                                       <li><a href="/spartacus-docs/beta-docs/checkout-libraries-release-notes/" class="active">Checkout Libraries Release Notes</a></li>

                                                                                  

                                                                                    
                                                                                    
                                                                                  
                                                                                    
                                                                                    
                                                                                         
                                                                                       <li><a href="/spartacus-docs/beta-docs/5-0-typescript-breaking-changes/" class="">5.0 Typescript Breaking Changes</a></li>

                                                                                       
                                                                                        
                                                                              
                                                                                        
                                                                              
                                                                            </ul>                
                                                                             
                                                                          </li>
                                                                      

                                                                        
                                                                        
                                                                        
                                                                        <li><a href="/spartacus-docs/beta-docs/updating-to-version-4/">Updating to Version 4.0 ➢</a>

                                                                          
                                                                            <ul>
                                                                              
                                                                                        
                                                                              
                                                                                        
                                                                              
                                                                            </ul>                
                                                                             
                                                                          </li>
                                                                      

                                                                        
                                                                        
                                                                        
                                                                        <li><a href="/spartacus-docs/beta-docs/updating-to-version-3/">Updating to Version 3.0 ➢</a>

                                                                          
                                                                            <ul>
                                                                              
                                                                                        
                                                                              
                                                                                        
                                                                              
                                                                            </ul>                
                                                                             
                                                                          </li>
                                                                      

                                                                        
                                                                        
                                                                        
                                                                        <li><a href="/spartacus-docs/beta-docs/updating-to-version-2/">Updating to Version 2.0 ➢</a>

                                                                          
                                                                            <ul>
                                                                              
                                                                                        
                                                                              
                                                                                        
                                                                              
                                                                            </ul>                
                                                                             
                                                                          </li>
                                                                      

                                                                        
                                                                        
                                                                        
                                                                        <li><a href="/spartacus-docs/beta-docs/misc-release-notes/">Miscellaneous Release Notes ➢</a>

                                                                          
                                                                            <ul>
                                                                              
                                                                                        
                                                                              
                                                                            </ul>                
                                                                             
                                                                          </li>
                                                                      

                                                                        
                                                                        
                                                                        
                                                                        <li><a href="/spartacus-docs/beta-docs/known-issues/">Known Issues</a>

                                                                          
                                                                            <ul>
                                                                              
                                                                            </ul>                
                                                                             
                                                                          </li>
                                                                      
                                                                      
                                                                  
                                                                      
                                                                  
                                                                
                                                                  
                                                                      
                                                                  
                                                                      
                                                                  
                                                                
                                                                  
                                                                      
                                                                  
                                                                      
                                                                  
                                                                
                                                                  
                                                                      
                                                                  
                                                                      
                                                                  
                                                                
                                                                  
                                                                      
                                                                  
                                                                
                                                                  
                                                                
                                                            </ul>
                                                    </li>
                                                    
                                                

                                                
                                                

                                                  

                                                    <li><a href="/spartacus-docs/beta-docs/spartacus-videos/">Spartacus Videos</a>
                                                  
                                                            <ul>
                                                                
                                                            </ul>
                                                    </li>
                                                    
                                                

                                                
                                                

                                                  

                                                    <li><a href="/spartacus-docs/beta-docs/spartacus-roadmap/">Spartacus Roadmap</a>
                                                  
                                                            <ul>
                                                                
                                                            </ul>
                                                    </li>
                                                    
                                                

                                                
                                                

                                                  

                                                    <li><a href="/spartacus-docs/beta-docs/spartacus-faq/">Spartacus FAQ</a>
                                                  
                                                            <ul>
                                                                
                                                            </ul>
                                                    </li>
                                                    
                                                

                                                
                                                

                                                  

                                                    <li><a href="/spartacus-docs/beta-docs/docs-archive/">Documentation Archive</a>
                                                  
                                                            <ul>
                                                                
                                                            </ul>
                                                    </li>
                                                    
                                                
                                        
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
            </ul>  
      </li>          
    
      <li>
        
          
          

         <a href="/spartacus-docs/beta-docs/getting-started/"><span class="nav__sub-title">Getting Started with Spartacus Libraries</span></a>
         
        
            <ul>
                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
            </ul>  
      </li>          
    
      <li>
        
          
          

         <a href="/spartacus-docs/beta-docs/dev-guide/"><span class="nav__sub-title">Storefront Development Guide</span></a>
         
        
            <ul>
                
                        <ul>
                            
                                    

                                  
                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
            </ul>  
      </li>          
    
      <li>
        
          
          

         <a href="/spartacus-docs/beta-docs/using-spartacus/"><span class="nav__sub-title">Using the Spartacus Storefront</span></a>
         
        
            <ul>
                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
            </ul>  
      </li>          
    
      <li>
        
          
          

         <a href="/spartacus-docs/beta-docs/about-tua-spartacus/"><span class="nav__sub-title">Telco & Utilities Storefront Development Guide</span></a>
         
        
            <ul>
                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
            </ul>  
      </li>          
    
      <li>
        
          
          

         <a href="/spartacus-docs/beta-docs/about-fsa-spartacus/"><span class="nav__sub-title">Financial Services Accelerator Storefront Development Guide</span></a>
         
        
            <ul>
                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    
                                            
                                    
                                            
                                    
                                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
            </ul>  
      </li>          
    
      <li>
        
          
          

         <a href="/spartacus-docs/beta-docs/contributors-guide/"><span class="nav__sub-title">Contributing to Spartacus</span></a>
         
        
            <ul>
                
                        <ul>
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                                    

                                  
                            
                        </ul>
   
                    

                    

                
                        <ul>
                            
                        </ul>
   
                    

                    

                
            </ul>  
      </li>          
    
  </ul>
</nav>      

    
  
  </div>


  <div class="archive">
    
      <h1 id="page-title" class="page__title">Checkout Libraries Release Notes</h1>
    
    <p>The release of Spartacus 5.0 introduces three different entry points for the <code class="language-plaintext highlighter-rouge">@spartacus/checkout</code> library.</p>

<p>The new entry points for the <code class="language-plaintext highlighter-rouge">@spartacus/checkout</code> library are the following:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">@spartacus/checkout/base</code>, which includes basic checkout functionalities that cater especially to business-to-consumer (B2C) checkout flows.</li>
  <li><code class="language-plaintext highlighter-rouge">@spartacus/checkout/b2b</code>, which includes the basic checkout functionalities from the base library, as well as additional checkout flows that cater to business-to-business (B2B) scenarios.</li>
  <li><code class="language-plaintext highlighter-rouge">@spartacus/checkout/scheduled-replenishment</code>, which includes the functionalities of both the base and B2B checkout libraries, and also allows the user to either place a regular order, or schedule a replenishment order.</li>
</ul>

<hr />

<p><strong>Table of Contents</strong></p>

<ul id="markdown-toc">
  <li><a href="#general-changes" id="markdown-toc-general-changes">General Changes</a></li>
  <li><a href="#new-functionality" id="markdown-toc-new-functionality">New Functionality</a></li>
  <li><a href="#sample-data-changes" id="markdown-toc-sample-data-changes">Sample Data Changes</a></li>
  <li><a href="#events" id="markdown-toc-events">Events</a></li>
  <li><a href="#commands-and-queries-example-in-checkout" id="markdown-toc-commands-and-queries-example-in-checkout">Commands and Queries Example in Checkout</a></li>
  <li><a href="#how-to-properly-make-use-of-queries-in-checkout" id="markdown-toc-how-to-properly-make-use-of-queries-in-checkout">How to Properly Make Use of Queries in Checkout</a></li>
  <li><a href="#customizing-the-lazy-loaded-checkout-module" id="markdown-toc-customizing-the-lazy-loaded-checkout-module">Customizing the Lazy Loaded Checkout Module</a></li>
  <li><a href="#migrations" id="markdown-toc-migrations">Migrations</a>    <ul>
      <li><a href="#manually-updating-from-old-checkout-facades" id="markdown-toc-manually-updating-from-old-checkout-facades">Manually Updating From Old Checkout Facades</a></li>
      <li><a href="#using-the-newly-created-checkout-components" id="markdown-toc-using-the-newly-created-checkout-components">Using the Newly Created Checkout Components</a></li>
      <li><a href="#example-of-removing-ngrx-by-using-spartacus-commands-and-queries" id="markdown-toc-example-of-removing-ngrx-by-using-spartacus-commands-and-queries">Example of Removing NgRx by Using Spartacus Commands and Queries</a></li>
      <li><a href="#mixing-ngrx-with-commands-and-queries" id="markdown-toc-mixing-ngrx-with-commands-and-queries">Mixing NgRx with Commands and Queries</a></li>
      <li><a href="#migrating-reducers" id="markdown-toc-migrating-reducers">Migrating Reducers</a></li>
    </ul>
  </li>
</ul>

<hr />

<p>In Spartacus 4.0, a new <a href="https://sap.github.io/spartacus-docs/technical-changes-version-4/#new-checkout-library">checkout library</a> was created by extracting the checkout functionality from the original Spartacus libraries. However, this new checkout library only had a single entry point that contained all checkout flows, even if they were not be used (such as the <a href="https://sap.github.io/spartacus-docs/scheduled-replenishment/#setting-up-a-replenishment-order">scheduled replenishment flow</a>, for example). However, in Spartacus 5.0, the library has been further decoupled into different business logic features, with the intention of having a smaller bundle size.</p>

<p>In addition to creating different entry points to reduce the bundle size, NgRx dependencies have been mostly removed (with the exception of a few NgRx actions that are isolated within an event listener), and this has been done by replacing them with <a href="https://sap.github.io/spartacus-docs/commands-and-queries/">commands and queries</a>. It is currently not possible to fully separate NgRx from checkout until other libraries from Spartacus are refactored, such as the Cart or user libraries.</p>

<p>THe benefits of converting to <code class="language-plaintext highlighter-rouge">command and queries</code> are the following:</p>

<ul>
  <li>All functionality is in classes, so it is easier to extend, as opposed to NgRx, where you can not really extend a reducer or an effect (without dismantling deeply nested NgRx modules in Spartacus).</li>
  <li>Commands are built in a more reactive way, and return the execution result as part of the same method call.</li>
  <li>Similarly to the commands, listening to loading, error, and data state changes is as simple as calling one method and getting all the results in one call through queries.</li>
  <li>It is much simpler to compose streams with commands and queries because Spartacus is able to chain (or pipe) to the execution of the action.</li>
</ul>

<p>For more information, see the <a href="https://sap.github.io/spartacus-docs/commands-and-queries/#commands-overview">Commands Overview</a>.</p>

<p>Finally, the business logic for placing an order or scheduling a replenishment order was moved to the order library. The reason for this decision is that the logic to place an order was coupled with a normalizer that existed in the order library, which would break the lazy loading mechanism that is in place. Therefore, the decision was made to move the place order business logic to the order library as it is now <a href="https://sap.github.io/spartacus-docs/lazy-loading-guide/#exposing-smart-proxy-facades-from-lazy-loaded-features">programmatically lazy loaded</a> when reaching the last step in the checkout process.</p>

<h2 id="general-changes">General Changes</h2>

<p>The following is a list of general changes made to the checkout libraries:</p>

<ul>
  <li>The majority of old checkout imports (<code class="language-plaintext highlighter-rouge">@spartacus/checkout</code>) are now spread across the new entry points (<code class="language-plaintext highlighter-rouge">@spartacus/checkout/base</code>, <code class="language-plaintext highlighter-rouge">@spartacus/checkout/b2b</code>, <code class="language-plaintext highlighter-rouge">@spartacus/checkout/scheduled-replenishment</code>), and their secondary entry points (such as, <code class="language-plaintext highlighter-rouge">@spartacus/checkout/base/core</code>, <code class="language-plaintext highlighter-rouge">@spartacus/checkout/base/occ</code>, <code class="language-plaintext highlighter-rouge">@spartacus/checkout/base/components</code>).</li>
  <li>Services now use commands and queries instead of making use of NgRx for state management.</li>
  <li><code class="language-plaintext highlighter-rouge">normalizeHttpError()</code> is moved from the effects to the adapter layer.</li>
  <li>The following order confirmation components are moved to the order library.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">OrderConfirmationThankYouMessageComponent</code></li>
      <li><code class="language-plaintext highlighter-rouge">OrderConfirmationItemsComponent</code></li>
      <li><code class="language-plaintext highlighter-rouge">OrderConfirmationTotalsComponent</code></li>
      <li><code class="language-plaintext highlighter-rouge">GuestRegisterFormComponent</code></li>
    </ul>
  </li>
  <li>The business logic for placing an order and scheduling a replenishment is moved to the order library.</li>
  <li>The checkout flow has a better transition experience as a result of enhanced smoothing, less requests and less duplicated requests, and a uniform spinner for every step.</li>
  <li>Most checkout components from Spartacus 4.0 have been re-named to be prefixed with Checkout (for example, <code class="language-plaintext highlighter-rouge">CheckoutPlaceOrderComponent</code>).</li>
  <li>The <code class="language-plaintext highlighter-rouge">defaultB2bCheckoutConfig</code> was moved to <code class="language-plaintext highlighter-rouge">@spartacus/checkout/b2b/root</code>, and renamed to <code class="language-plaintext highlighter-rouge">defaultB2BCheckoutConfig</code> (note the capital <code class="language-plaintext highlighter-rouge">B2B</code>).</li>
  <li>If you are using the out-of-the-box checkout feature, and lazily loading <code class="language-plaintext highlighter-rouge">CheckoutModule</code> from <code class="language-plaintext highlighter-rouge">@spartacus/checkout</code>, you need to change the dynamic import path to <code class="language-plaintext highlighter-rouge">@spartacus/checkout/base</code>. It should look like something like the following example:</li>
</ul>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">provideConfig</span><span class="p">({</span>
  <span class="na">featureModules</span><span class="p">:</span> <span class="p">{</span>
    <span class="p">[</span><span class="nx">CHECKOUT_FEATURE</span><span class="p">]:</span> <span class="p">{</span>
      <span class="na">module</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span>
        <span class="k">import</span><span class="p">(</span><span class="dl">'</span><span class="s1">@spartacus/checkout/base</span><span class="dl">'</span><span class="p">).</span><span class="nx">then</span><span class="p">((</span><span class="nx">m</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">m</span><span class="p">.</span><span class="nx">CheckoutModule</span><span class="p">),</span>
    <span class="p">},</span>
  <span class="p">},</span>
<span class="p">});</span>
</code></pre></div></div>

<h2 id="new-functionality">New Functionality</h2>

<p>The following is a list of new functionality in the checkout libraries:</p>

<ul>
  <li>THe <code class="language-plaintext highlighter-rouge">backOff</code> pattern is now added to the OCC adapters, and configured to retry on OCC-specific JALO errors.</li>
  <li>For validation and error handling, the commands now perform various precondition checks. At the same time, commands will throw errors if the execution fails. Previously, effects dispatched Fail actions, which usually were not handled.</li>
</ul>

<h2 id="sample-data-changes">Sample Data Changes</h2>

<p>The following is a list of sample data changes in the checkout libraries:</p>

<ul>
  <li>The CheckoutShippingAddress <code class="language-plaintext highlighter-rouge">ContentPage</code> has been renamed to <code class="language-plaintext highlighter-rouge">CheckoutDeliveryAddress</code>
    <ul>
      <li>The title of the content page has been changed from <code class="language-plaintext highlighter-rouge">Checkout Shipping Address</code> to <code class="language-plaintext highlighter-rouge">Checkout Delivery Address</code></li>
      <li>The page route has been changed from <code class="language-plaintext highlighter-rouge">/checkout/shipping-address</code> to <code class="language-plaintext highlighter-rouge">/checkout/delivery-address</code></li>
    </ul>
  </li>
  <li>The CheckoutShippingAddressComponent <code class="language-plaintext highlighter-rouge">CMSComponent</code> has been renamed to <code class="language-plaintext highlighter-rouge">CheckoutDeliveryAddress</code></li>
  <li>The BodyContentSlot-checkoutShippingAddress <code class="language-plaintext highlighter-rouge">ContentSlot</code> has been renamed to <code class="language-plaintext highlighter-rouge">BodyContentSlot-checkoutDeliveryAddress</code></li>
  <li>The SideContent-checkoutShippingAddress <code class="language-plaintext highlighter-rouge">ContentSlot</code> has been renamed to <code class="language-plaintext highlighter-rouge">SideContent-checkoutDeliveryAddress</code></li>
</ul>

<p><strong>Note:</strong> The new checkout library is not backwards compatible. This library is intended to be used with new applications that are created with other Spartacus 5.0 libraries. If you generate a new storefront app using schematics, the app will use the new checkout library by default. For more information, see <a href="/spartacus-docs/beta-docs/schematics/#integration-libraries-and-feature-libraries">Integration Libraries and Feature Libraries</a>.</p>

<h2 id="events">Events</h2>

<p>Checkout events are essential because they are used to perform side effects. These events help remove the side effects done from <code class="language-plaintext highlighter-rouge">effects</code> when using NgRx. Events are caught either by event listeners (classes ending with <code class="language-plaintext highlighter-rouge">-event.listener</code>) or <a href="https://sap.github.io/spartacus-docs/commands-and-queries/#queries-overview">queries to reset/reload the data state</a>.</p>

<p><strong>Note:</strong> All events can be found in our <a href="https://sap.github.io/spartacus-docs/event-service/#list-of-spartacus-events">Spartacus events table</a>.</p>

<h2 id="commands-and-queries-example-in-checkout">Commands and Queries Example in Checkout</h2>

<p>As mentioned, the new checkout libraries have mostly removed NgRx dependencies while adapting to the Spartacus commands and queries pattern. The following is an example:</p>

<ol>
  <li>
    <p>Components inject facades (example: <a href="https://github.com/SAP/spartacus/blob/develop/feature-libs/checkout/base/components/checkout-delivery-address/checkout-delivery-address.component.ts">CheckoutDeliveryAddressComponent</a>).</p>

    <p>In <a href="https://sap.github.io/spartacus-docs/proxy-facades/#defining-proxy-facades">Defining Proxy Facades</a>, you can read a description of the dependency injection to the proxy facade, where the actual implementation is provided using a dependency provider. In the case of checkout, the facade service contains the business logic executed by commands and queries, as shown in the following example:</p>

    <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">constructor</span><span class="p">(</span>
    <span class="p">...</span>
    <span class="k">protected</span> <span class="nx">checkoutDeliveryAddressFacade</span><span class="p">:</span> <span class="nx">CheckoutDeliveryAddressFacade</span><span class="p">,</span>
    <span class="k">protected</span> <span class="nx">checkoutDeliveryModesFacade</span><span class="p">:</span> <span class="nx">CheckoutDeliveryModesFacade</span><span class="p">,</span>
    <span class="p">...</span>
  <span class="p">)</span> <span class="p">{}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Facades execute commands and queries (example: <a href="https://github.com/SAP/spartacus/blob/develop/feature-libs/checkout/base/core/facade/checkout-delivery-address.service.ts">CheckoutDeliveryAddressFacade</a>).</p>

    <p>Most of the time, each facade service injects both the <code class="language-plaintext highlighter-rouge">CommandService</code> and <code class="language-plaintext highlighter-rouge">QueryService</code>.</p>

    <p>In the <code class="language-plaintext highlighter-rouge">CheckoutQueryFacade</code>, Spartacus now has a checkout details query that serves as a single source of truth for the checkout state, and is updated after each change the user does during the checkout.</p>

    <p>A <a href="https://sap.github.io/spartacus-docs/commands-and-queries/#commands-overview">command</a> is created in order to execute an action. In this case, it is for creating a delivery address. As seen in the snippet below, the command type is of <code class="language-plaintext highlighter-rouge">Command&lt;Address, unknown&gt;</code>. Address is for the input and unknown is for the output. The input for this case is required for the command to execute while the output ‘may’ be unknown.</p>
  </li>
  <li>
    <p>Commands can dispatch events (for other side effects).</p>

    <p>The following snippet is taken from the <code class="language-plaintext highlighter-rouge">createDeliveryAddressCommand</code>, which can be found in the source code under the <a href="https://github.com/SAP/spartacus/blob/7bba93e0e6b75024371361b169348cfaebeb2c7b/feature-libs/checkout/base/core/facade/checkout-delivery-address.service.ts#L29">checkout-delivery-address.service.ts</a>. After successfully creating an address, we are <a href="https://sap.github.io/spartacus-docs/event-service/#dispatching-individual-events">dispatching events</a> under the tap operator in order to be caught by our event listeners to perform additional actions.</p>

    <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">checkoutDeliveryAddressConnector</span>
  <span class="p">.</span><span class="nx">createAddress</span><span class="p">(</span><span class="nx">userId</span><span class="p">,</span> <span class="nx">cartId</span><span class="p">,</span> <span class="nx">payload</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
    <span class="nx">tap</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="p">...</span>
    <span class="p">}),</span>
    <span class="nx">map</span><span class="p">((</span><span class="nx">address</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="p">...</span>
    <span class="p">}),</span>
    <span class="nx">tap</span><span class="p">((</span><span class="nx">address</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">eventService</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span> <span class="c1">// &lt;-- Event dispatching</span>
        <span class="p">{</span>
          <span class="nx">userId</span><span class="p">,</span>
          <span class="nx">cartId</span><span class="p">,</span>
          <span class="nx">address</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="nx">CheckoutDeliveryAddressCreatedEvent</span>
      <span class="p">)</span>
    <span class="p">)</span>
</code></pre></div>    </div>

    <p>Event listeners are flexible, so you can inject any number of dependencies to perform certain actions. For example, in this case it fires additional events, such as <a href="https://sap.github.io/spartacus-docs/event-service/#list-of-spartacus-events"><code class="language-plaintext highlighter-rouge">CheckoutResetDeliveryModesEvent</code></a> and <a href="https://sap.github.io/spartacus-docs/event-service/#list-of-spartacus-events"><code class="language-plaintext highlighter-rouge">CheckoutResetQueryEvent</code></a>.</p>

    <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">protected</span> <span class="nx">onDeliveryAddressChange</span><span class="p">():</span> <span class="k">void</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">subscriptions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">eventService</span>
        <span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">CheckoutDeliveryAddressCreatedEvent</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">subscribe</span><span class="p">(({</span> <span class="nx">userId</span><span class="p">,</span> <span class="nx">cartId</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">globalMessageService</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
            <span class="p">{</span> <span class="na">key</span><span class="p">:</span> <span class="dl">'</span><span class="s1">addressForm.userAddressAddSuccess</span><span class="dl">'</span> <span class="p">},</span>
            <span class="nx">GlobalMessageType</span><span class="p">.</span><span class="nx">MSG_TYPE_CONFIRMATION</span>
          <span class="p">);</span>
   
          <span class="k">this</span><span class="p">.</span><span class="nx">eventService</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span>
            <span class="p">{</span> <span class="nx">userId</span><span class="p">,</span> <span class="nx">cartId</span> <span class="p">},</span>
            <span class="nx">CheckoutResetDeliveryModesEvent</span>
          <span class="p">);</span>
   
          <span class="k">this</span><span class="p">.</span><span class="nx">eventService</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">({},</span> <span class="nx">CheckoutResetQueryEvent</span><span class="p">);</span>
        <span class="p">})</span>
    <span class="p">);</span>
    <span class="p">...</span>
</code></pre></div>    </div>

    <p>The example for <a href="https://sap.github.io/spartacus-docs/event-service/#list-of-spartacus-events"><code class="language-plaintext highlighter-rouge">CheckoutResetQueryEvent</code></a> being fired is to reset the checkout details query from the <code class="language-plaintext highlighter-rouge">CheckoutQueryFacade</code>, due to the nature of Spartacus commands and queries, where it is possible to <a href="https://sap.github.io/spartacus-docs/commands-and-queries/#queries-overview">reload or reset a query</a>.</p>
  </li>
</ol>

<h2 id="how-to-properly-make-use-of-queries-in-checkout">How to Properly Make Use of Queries in Checkout</h2>

<p>Example: <a href="https://github.com/SAP/spartacus/blob/7bba93e0e6b75024371361b169348cfaebeb2c7b/feature-libs/checkout/base/core/facade/checkout-query.service.ts">CheckoutQueryFacade</a> and <a href="https://github.com/SAP/spartacus/blob/7bba93e0e6b75024371361b169348cfaebeb2c7b/feature-libs/checkout/base/components/checkout-delivery-address/checkout-delivery-address.component.ts">CheckoutDeliveryAddressComponent</a></p>

<p>The “checkout details query” that is injected into other checkout “facade” services is used to get the current checkout details, which contain information on the delivery address, the delivery mode, and payment information when using the base checkout. When using the B2B checkout, you have additional data, such as “purchase order number”, “cost centers”, and “payment type”.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">protected</span> <span class="nx">checkoutQuery$</span><span class="p">:</span> <span class="nx">Query</span><span class="o">&lt;</span><span class="nx">CheckoutState</span> <span class="o">|</span> <span class="kc">undefined</span><span class="o">&gt;</span> <span class="o">=</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">queryService</span><span class="p">.</span><span class="nx">create</span><span class="o">&lt;</span><span class="nx">CheckoutState</span> <span class="o">|</span> <span class="kc">undefined</span><span class="o">&gt;</span><span class="p">(</span>
      <span class="p">()</span> <span class="o">=&gt;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">checkoutPreconditions</span><span class="p">().</span><span class="nx">pipe</span><span class="p">(</span>
          <span class="nx">switchMap</span><span class="p">(([</span><span class="nx">userId</span><span class="p">,</span> <span class="nx">cartId</span><span class="p">])</span> <span class="o">=&gt;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">checkoutConnector</span><span class="p">.</span><span class="nx">getCheckoutDetails</span><span class="p">(</span><span class="nx">userId</span><span class="p">,</span> <span class="nx">cartId</span><span class="p">)</span>
          <span class="p">)</span>
        <span class="p">),</span>
      <span class="p">{</span>
        <span class="na">reloadOn</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">getQueryReloadTriggers</span><span class="p">(),</span>
        <span class="na">resetOn</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">getQueryResetTriggers</span><span class="p">(),</span>
      <span class="p">}</span>
    <span class="p">);</span>

    <span class="nx">getCheckoutDetailsState</span><span class="p">():</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">QueryState</span><span class="o">&lt;</span><span class="nx">CheckoutState</span> <span class="o">|</span> <span class="kc">undefined</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">checkoutQuery$</span><span class="p">.</span><span class="nx">getState</span><span class="p">();</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">getCheckoutDetailsState</code> returns the entire state, which is an object composed of loading, error, and data properties, but you can always create additional methods in your extended service to include only getting the data. In this case, you would only need to use <code class="language-plaintext highlighter-rouge">.get()</code> instead of <code class="language-plaintext highlighter-rouge">.getState()</code> when executing queries, as shown in the following example:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nx">getCheckoutDetails</span><span class="p">():</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">CheckoutState</span> <span class="o">|</span> <span class="kc">undefined</span><span class="o">&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">checkoutQuery$</span><span class="p">.</span><span class="kd">get</span><span class="p">();</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>When queries are used to get the state, it is recommended to filter the loading state. You should also consider using the RxJS <code class="language-plaintext highlighter-rouge">distinctUntilChanged</code> operator in order to reduce the number of emissions. In the following example, we are making sure to get the selected delivery address only when the data state is not loading, and we are also making sure we get only the distinct emissions:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">get</span> <span class="nx">selectedAddress$</span><span class="p">():</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">Address</span> <span class="o">|</span> <span class="kc">undefined</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">checkoutDeliveryAddressFacade</span><span class="p">.</span><span class="nx">getDeliveryAddressState</span><span class="p">().</span><span class="nx">pipe</span><span class="p">(</span>
      <span class="nx">filter</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nx">state</span><span class="p">.</span><span class="nx">loading</span><span class="p">),</span>
      <span class="nx">map</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">state</span><span class="p">.</span><span class="nx">data</span><span class="p">),</span>
      <span class="nx">distinctUntilChanged</span><span class="p">((</span><span class="nx">prev</span><span class="p">,</span> <span class="nx">curr</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">prev</span><span class="p">?.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">curr</span><span class="p">?.</span><span class="nx">id</span><span class="p">)</span>
    <span class="p">);</span>
  <span class="p">}</span>
</code></pre></div></div>

<h2 id="customizing-the-lazy-loaded-checkout-module">Customizing the Lazy Loaded Checkout Module</h2>

<p>The principle for customizing the lazy loaded checkout module is the same as for any other module. For more information, see
<a href="https://sap.github.io/spartacus-docs/lazy-loading-guide/#customizing-lazy-loaded-modules">Customizing Lazy Loaded Modules</a>.</p>

<h2 id="migrations">Migrations</h2>

<p>Spartacus schematics are designed to assist you in your migration and to help make the transition from your current version to 5.0 go more smoothly.</p>

<p>Take a look at the <a href="https://github.com/SAP/spartacus/blob/84e6b462db1f5dca5c3145c5bc535fc5e2b52fe2/docs/migration/5_0-generated-typescript-changes-doc.md">5.0 TypeScript Changes</a> to get a high-level overview of what has changed.</p>

<h3 id="manually-updating-from-old-checkout-facades">Manually Updating From Old Checkout Facades</h3>

<p>Most components will need to be updated to use the new checkout facades.</p>

<p>To do so, make sure to change the type in the constructor, if applicable, and import from the new checkout library.</p>

<p>If you had a component such as the following:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">import</span> <span class="p">{</span> <span class="nx">CheckoutPaymentFacade</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@spartacus/checkout/root</span><span class="dl">'</span><span class="p">;</span>

  <span class="kd">class</span> <span class="nx">SomeOldCheckoutComponent</span> <span class="p">{</span>
    <span class="kd">constructor</span><span class="p">(</span>
      <span class="p">...</span>
      <span class="k">protected</span> <span class="nx">checkoutPaymentFacade</span><span class="p">:</span> <span class="nx">CheckoutPaymentFacade</span>
    <span class="p">)</span> <span class="p">{}</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>You can update is as follows:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">import</span> <span class="p">{</span> <span class="nx">CheckoutPaymentFacade</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@spartacus/checkout/base/root</span><span class="dl">'</span><span class="p">;</span>

  <span class="kd">class</span> <span class="nx">SomeOldCheckoutComponent</span> <span class="p">{</span>
    <span class="kd">constructor</span><span class="p">(</span>
      <span class="p">...</span>
      <span class="k">protected</span> <span class="nx">checkoutPaymentFacade</span><span class="p">:</span> <span class="nx">CheckoutPaymentFacade</span>
    <span class="p">)</span> <span class="p">{}</span>
  <span class="p">}</span>
</code></pre></div></div>

<p><strong>Note:</strong> The “new” checkout would be from either <code class="language-plaintext highlighter-rouge">@spartacus/checkout/base/root</code>, <code class="language-plaintext highlighter-rouge">@spartacus/checkout/b2b/root</code>, or <code class="language-plaintext highlighter-rouge">@spartacus/checkout/scheduled-replenishment/root</code>.</p>

<h3 id="using-the-newly-created-checkout-components">Using the Newly Created Checkout Components</h3>

<p>You can consider whether to use the new Spartacus checkout components, such as <code class="language-plaintext highlighter-rouge">CheckoutPaymentTypeComponent</code>, instead of the old <code class="language-plaintext highlighter-rouge">PaymentTypeComponent</code>.</p>

<p>If you do not want to use the newly created Spartacus components that consume the new facades with commands and queries under the hood, you can always import the new facade into your existing components and adapt the code accordingly.</p>

<h3 id="example-of-removing-ngrx-by-using-spartacus-commands-and-queries">Example of Removing NgRx by Using Spartacus Commands and Queries</h3>

<p>Let’s imagine a use case where you customized the loading of payment types in the checkout payment type step.</p>

<p>With the old checkout implementation that uses NgRx prior to the refactor, you would need to dismantle the checkout module(s) and replace the default Spartacus store modules (usually the <code class="language-plaintext highlighter-rouge">effect</code>s and <code class="language-plaintext highlighter-rouge">reducer</code>s).
Additionally, if you wanted to add custom logic in the old implementation, you could also “tap” into the NgRx actions stream, and listen for relevant actions in order to perform additional logic.</p>

<p>For example, you might have a custom effect, such as the following:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Injectable</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@angular/core</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Actions</span><span class="p">,</span> <span class="nx">Effect</span><span class="p">,</span> <span class="nx">ofType</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@ngrx/effects</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">CheckoutActions</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@spartacus/checkout/core</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">switchMap</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">rxjs/operators</span><span class="dl">'</span><span class="p">;</span>

<span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">CustomPaymentTypesEffects</span> <span class="p">{</span>
  <span class="p">@</span><span class="nd">Effect</span><span class="p">()</span>
  <span class="nx">loadPaymentTypes$</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">actions$</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
    <span class="nx">ofType</span><span class="p">(</span><span class="nx">CheckoutActions</span><span class="p">.</span><span class="nx">LOAD_PAYMENT_TYPES_SUCCESS</span><span class="p">),</span>
    <span class="nx">switchMap</span><span class="p">((</span><span class="nx">action</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// ... custom logic ...</span>
    <span class="p">})</span>
  <span class="p">);</span>

  <span class="p">...</span>

  <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="nx">actions$</span><span class="p">:</span> <span class="nx">Actions</span><span class="p">)</span> <span class="p">{}</span>

  <span class="p">...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>With the newly refactored checkout that uses commands and queries, you can now simply extend the relevant facade (such as <code class="language-plaintext highlighter-rouge">CheckoutPaymentTypeFacade</code>) and override the relevant method (such as <code class="language-plaintext highlighter-rouge">getPaymentTypes()</code>), which enables the use of adding custom logic in a central place. Another benefit of this approach is the fact that the custom logic applies to all the callers.</p>

<p>Alternatively, if you have a use case where you need to apply the custom logic to only one place, without affecting other callers, you can simply do the following:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">ChangeDetectionStrategy</span><span class="p">,</span> <span class="nx">Component</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@angular/core</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">PaymentType</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@spartacus/cart/base/root</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">CheckoutPaymentTypeFacade</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@spartacus/checkout/b2b/root</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Observable</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">rxjs</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">tap</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">rxjs/operators</span><span class="dl">'</span><span class="p">;</span>

<span class="p">@</span><span class="nd">Component</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="dl">'</span><span class="s1">cx-payment-type</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">templateUrl</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./custom-checkout-payment-type.component.html</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">changeDetection</span><span class="p">:</span> <span class="nx">ChangeDetectionStrategy</span><span class="p">.</span><span class="nx">OnPush</span><span class="p">,</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">CustomCheckoutPaymentTypeComponent</span> <span class="p">{</span>
  <span class="p">...</span>

  <span class="nx">paymentTypes$</span><span class="p">:</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">PaymentType</span><span class="p">[]</span><span class="o">&gt;</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">checkoutPaymentTypeFacade</span>
    <span class="p">.</span><span class="nx">getPaymentTypes</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
      <span class="nx">tap</span><span class="p">(</span>
        <span class="c1">// handle next / success case</span>
        <span class="p">(</span><span class="nx">paymentTypes</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="c1">// custom logic</span>
        <span class="p">},</span>
        <span class="c1">// handle error</span>
        <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{}</span>
      <span class="p">)</span>
    <span class="p">);</span>

  <span class="kd">constructor</span><span class="p">(</span><span class="k">protected</span> <span class="nx">checkoutPaymentTypeFacade</span><span class="p">:</span> <span class="nx">CheckoutPaymentTypeFacade</span><span class="p">)</span> <span class="p">{}</span>

  <span class="p">...</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="mixing-ngrx-with-commands-and-queries">Mixing NgRx with Commands and Queries</h3>

<p>The following are some reasons why you would mix NgRx with command and queries:</p>

<ul>
  <li>Synchronizing the other parts of the (custom) state after the checkout state changes</li>
  <li>Gradually moving your custom NgRx-based logic to commands and queries during a transitional period</li>
</ul>

<p>You can achieve this by using the relevant checkout events and NgRx actions.</p>

<p>If you would like to dispatch a custom NgRx action after a checkout event happens, you can either override the existing event listener, and alter the default behavior, or you can create a new listener and do something such as the following:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Injectable</span><span class="p">,</span> <span class="nx">OnDestroy</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@angular/core</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Store</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@ngrx/store</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span>
  <span class="nx">EventService</span><span class="p">,</span>
  <span class="nx">LoadUserAddressesEvent</span><span class="p">,</span>
  <span class="nx">UserActions</span><span class="p">,</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@spartacus/core</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Subscription</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">rxjs</span><span class="dl">'</span><span class="p">;</span>

<span class="p">@</span><span class="nd">Injectable</span><span class="p">({</span>
  <span class="na">providedIn</span><span class="p">:</span> <span class="dl">'</span><span class="s1">root</span><span class="dl">'</span><span class="p">,</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">CustomCheckoutStoreEventListener</span> <span class="k">implements</span> <span class="nx">OnDestroy</span> <span class="p">{</span>
  <span class="k">protected</span> <span class="nx">subscriptions</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subscription</span><span class="p">();</span>

  <span class="kd">constructor</span><span class="p">(</span>
    <span class="k">protected</span> <span class="nx">eventService</span><span class="p">:</span> <span class="nx">EventService</span><span class="p">,</span>
    <span class="k">protected</span> <span class="nx">store</span><span class="p">:</span> <span class="nx">Store</span><span class="o">&lt;</span><span class="nx">unknown</span><span class="o">&gt;</span>
  <span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">onUserAddressAction</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="k">protected</span> <span class="nx">onUserAddressAction</span><span class="p">():</span> <span class="k">void</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">subscriptions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">eventService</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">LoadUserAddressesEvent</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">(({</span> <span class="nx">userId</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="k">new</span> <span class="nx">UserActions</span><span class="p">.</span><span class="nx">LoadUserAddresses</span><span class="p">(</span><span class="nx">userId</span><span class="p">));</span>
      <span class="p">})</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">ngOnDestroy</span><span class="p">():</span> <span class="k">void</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">subscriptions</span><span class="p">.</span><span class="nx">unsubscribe</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="migrating-reducers">Migrating Reducers</h3>

<p>The reducers update the state based on the action’s payload. To customize the state in the new checkout, you can extend the appropriate facade and override the relevant method that returns the result of the query.</p>

<p>Because all queries are plain observables, you can compose multiple streams if needed, and use the <code class="language-plaintext highlighter-rouge">map</code> operator of <code class="language-plaintext highlighter-rouge">rxjs</code>.</p>


<!-- <h3 class="archive__subtitle">Recent posts</h3>




 -->

  </div>
</div>
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><div class="docsearch-container"><input type="search" id="docsearch" aria-placeholder="Enter your search term..." class="search-input" tabindex="-1" placeholder="Enter your search term..." /></div>
    <!-- <div id="results" class="results"></div> --></div>

      </div>
    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->
<table BORDER="0"><tr><td class="tdfooter"><a href="https://www.sap.com/copyright" target="_blank">Copyright</a></td>

<td class="tdfooter"><a href="https://sap.github.io/spartacus-docs/privacy-statement/">Privacy Statement</a></td>

<td class="tdfooter"><a href="https://www.sap.com/impressum" target="_blank">Legal Disclosure</a></td>

<td class="tdfooter"><a href="https://www.sap.com/trademark" target="_blank">Trademark</a></td>

<td class="tdfooter"><a href="https://www.sap.com/terms-of-use" target="_blank">Terms of Use</a></td></tr></table>
<!-- end custom footer snippets -->
        <!-- <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    <li><a href="/spartacus-docs/beta-docs/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 Spartacus Documentation. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div> -->

      </footer>
    </div>

    
  <script src="/spartacus-docs/beta-docs/assets/js/main.min.js"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.8.2/js/all.js" integrity="sha384-DJ25uNYET2XCl5ZF++U8eNxPWqcKohUUBUpKGlNLMchM7q4Wjg2CUpjHLaL8yYPH" crossorigin="anonymous"></script>










    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script> 
    <script type="text/javascript"> docsearch({ 
    appId: 'BNZEXRISC6',
    apiKey: '54a795a072ff713045038ee4ad33c990', 
    indexName: 'sap_spartacus', 
    inputSelector: '#docsearch', 
    algoliaOptions: {
      'facetFilters': ["tags:beta-docs"]
      },
    debug: false // Set debug to true if you want to inspect the dropdown 
    }); 
    </script> 

    <script>
      anchors.options = {
      visible: 'hover',
      icon: "\uf0c1"
      };
    anchors.add();
    </script>

    </body>
</html>
